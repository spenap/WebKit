{
  "version": 3,
  "sources": ["../src/iongraph.ts", "../src/utils.ts", "../src/dom.ts", "../src/dequal.ts", "../src/tweak.ts", "../src/Graph.ts", "../src/GraphViewer.ts", "../www/main.ts"],
  "sourcesContent": ["export const currentVersion = 1 as const;\n\nexport interface IonJSON {\n  version: typeof currentVersion,\n  functions: Func[],\n}\n\nexport interface Func {\n  name: string,\n  passes: Pass[],\n}\n\nexport interface Pass {\n  name: string,\n  mir: {\n    blocks: MIRBlock[],\n  },\n  lir: {\n    blocks: LIRBlock[],\n  },\n}\n\nexport type BlockPtr = number & { readonly __brand: \"BlockPtr\" }\nexport type BlockID = number & { readonly __brand: \"BlockID\" }\nexport type InsPtr = number & { readonly __brand: \"InsPtr\" }\nexport type InsID = number & { readonly __brand: \"InsID\" }\n\nexport interface MIRBlock {\n  ptr: BlockPtr,\n  id: BlockID,\n  loopDepth: number,\n  attributes: string[],\n  predecessors: BlockID[],\n  successors: BlockID[],\n  instructions: MIRInstruction[],\n}\n\nexport interface MIRInstruction {\n  ptr: InsPtr,\n  id: InsID,\n  opcode: string,\n  attributes: string[],\n  inputs: number[],\n  uses: number[],\n  memInputs: unknown[], // TODO\n  type: string,\n}\n\nexport interface LIRBlock {\n  ptr: BlockPtr,\n  id: BlockID,\n  instructions: LIRInstruction[],\n}\n\nexport interface LIRInstruction {\n  ptr: InsPtr,\n  id: InsID,\n  mirPtr: number | null,\n  opcode: string,\n  defs: number[],\n}\n\nexport interface SampleCounts {\n  selfLineHits: Map<number, number>,\n  totalLineHits: Map<number, number>,\n}\n\n/**\n * Migrate ion JSON data to the latest version of the schema. A history of\n * schema changes can be found at the end of the file.\n */\nexport function migrate(ionJSON: any): IonJSON {\n  if (ionJSON.version === undefined) {\n    ionJSON.version = 0;\n  }\n\n  for (const f of ionJSON.functions) {\n    migrateFunc(f, ionJSON.version);\n  }\n\n  ionJSON.version = currentVersion;\n  return ionJSON;\n}\n\nfunction migrateFunc(f: any, version: number): Func {\n  for (const p of f.passes) {\n    for (const b of p.mir.blocks) {\n      migrateMIRBlock(b, version);\n    }\n    for (const b of p.lir.blocks) {\n      migrateLIRBlock(b, version);\n    }\n  }\n\n  return f;\n}\n\nfunction migrateMIRBlock(b: any, version: number): MIRBlock {\n  if (version === 0) {\n    b.ptr = ((b.id ?? b.number) + 1) as any as BlockPtr;\n    b.id = b.number;\n  }\n\n  for (const ins of b.instructions) {\n    migrateMIRInstruction(ins, version);\n  }\n\n  return b;\n}\n\nfunction migrateMIRInstruction(ins: any, version: number): MIRInstruction {\n  if (version === 0) {\n    ins.ptr = ins.id;\n  }\n\n  return ins;\n}\n\nfunction migrateLIRBlock(b: any, version: number): MIRBlock {\n  if (version === 0) {\n    b.ptr = (b.id ?? b.number) as any as BlockPtr;\n    b.id = b.number;\n  }\n\n  for (const ins of b.instructions) {\n    migrateLIRInstruction(ins, version);\n  }\n\n  return b;\n}\n\nfunction migrateLIRInstruction(ins: any, version: number): LIRInstruction {\n  if (version === 0) {\n    ins.ptr = ins.id;\n    ins.mirPtr = null;\n  }\n\n  return ins;\n}\n\n/*\n# History of the ion.json schema\n\n- Version 0: \"Legacy\" ion.json as used by sstangl's iongraph tool. Never\n  explicitly versioned.\n\n- Version 1: Created for the release of the web-based iongraph tool. The first\n  explicitly-versioned schema. Key changes:\n  - Renamed \"number\" to \"id\" on MIR and LIR blocks for consistency with C++.\n  - Added \"ptr\" to MIR blocks and MIR and LIR instructions for stable\n    identification across passes. LIR blocks do not need this because they are\n    stably identified by their corresponding MIR block.\n  - Added \"mirPtr\" to LIR instructions so that they can be traced back to their\n    MIR instruction. May be null.\n\n*/", "export function clamp(x: number, min: number, max: number) {\n  return Math.max(min, Math.min(max, x));\n}\n\n// Framerate-independent lerp smoothing, as sourced from the following talk\n// by Freya Holm\u00E9r: https://youtu.be/LSNQuFEDOyQ?si=VqUxBF2r7mfnuba8\nexport function filerp(current: number, target: number, r: number, dt: number): number {\n  return (current - target) * Math.pow(r, dt) + target;\n}\n\nexport type Falsy = null | undefined | false | 0 | -0 | 0n | \"\";\n\nexport function assert<T>(cond: T | Falsy, msg?: string, soft = false): asserts cond is T {\n  if (!cond) {\n    if (soft) {\n      console.error(msg ?? \"Assertion failed\");\n    } else {\n      throw new Error(msg ?? \"Assertion failed\");\n    }\n  }\n}\n\nexport function must<T>(val: T | Falsy, msg?: string): T {\n  assert(val, msg);\n  return val;\n}\n", "/**\n * DOM utilities to ease the pain of document.createElement.\n */\n\ntype NonNull<T> = T extends null ? never : T;\ntype CopyNullable<Src, Dst> = Src extends null ? Dst | null : NonNull<Dst>;\ntype Falsy = null | undefined | false;\n\n/**\n * A slightly relaxed Node type for my DOM utilities.\n */\nexport type BNode = Node | string | Falsy;\n\n/**\n * Ensures a DOM Node.\n */\nexport function N<T extends BNode>(v: T): CopyNullable<T, Node> {\n  if (typeof v === \"string\") {\n    return document.createTextNode(v);\n  }\n  return v as any;\n}\n\n/**\n * Adds children to a DOM node.\n */\nexport function addChildren(n: Node, children: BNode[]) {\n  for (const child of children) {\n    if (child) {\n      n.appendChild(N(child));\n    }\n  }\n}\n\nexport function E<K extends keyof HTMLElementTagNameMap>(\n  type: K,\n  classes?: (string | Falsy)[],\n  init?: (el: HTMLElementTagNameMap[K]) => void,\n  children?: BNode[],\n): HTMLElementTagNameMap[K];\n\nexport function E(\n  type: string,\n  classes?: (string | Falsy)[],\n  init?: (el: HTMLElement) => void,\n  children?: BNode[],\n): HTMLElement;\n\n/**\n * Creates a DOM element.\n * @param type The type of DOM element to create (e.g. `\"div\"`)\n * @param classes Any classes to add to the element\n * @param children Any children to add to the element\n */\nexport function E(\n  type: string,\n  classes?: (string | Falsy)[],\n  init?: (el: HTMLElement) => void,\n  children?: BNode[],\n) {\n  const el = document.createElement(type);\n  if (classes && classes.length > 0) {\n    const actualClasses: string[] = classes.filter((c): c is string => !!c);\n    el.classList.add(...actualClasses);\n  }\n  init?.(el);\n  if (children) {\n    addChildren(el, children);\n  }\n  return el;\n}\n\n/**\n * Creates a DOM fragment.\n * @param children\n */\nexport function F(children: BNode[]): DocumentFragment {\n  const f = document.createDocumentFragment();\n  addChildren(f, children);\n  return f;\n}\n", "/*\n * Taken from the MIT-licensed dequal library by lukeed:\n * https://github.com/lukeed/dequal/blob/81075b120e86b5c8703c4c7ad0c541651b0df87f/src/lite.js\n *\n *\n * The MIT License (MIT)\n *\n * Copyright (c) Luke Edwards <luke.edwards05@gmail.com> (lukeed.com)\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\n\nvar has = Object.prototype.hasOwnProperty;\n\nexport function dequal(foo: any, bar: any): boolean {\n  var ctor, len;\n  if (foo === bar) return true;\n\n  if (foo && bar && (ctor = foo.constructor) === bar.constructor) {\n    if (ctor === Date) return foo.getTime() === bar.getTime();\n    if (ctor === RegExp) return foo.toString() === bar.toString();\n\n    if (ctor === Array) {\n      if ((len = foo.length) === bar.length) {\n        while (len-- && dequal(foo[len], bar[len]));\n      }\n      return len === -1;\n    }\n\n    if (!ctor || typeof foo === 'object') {\n      len = 0;\n      for (ctor in foo) {\n        if (has.call(foo, ctor) && ++len && !has.call(bar, ctor)) return false;\n        if (!(ctor in bar) || !dequal(foo[ctor], bar[ctor])) return false;\n      }\n      return Object.keys(bar).length === len;\n    }\n  }\n\n  return foo !== foo && bar !== bar;\n}\n", "/**\n * A Tweak is a \"mutable number\"\u2014a value that coerces to a number in most\n * contexts but can be mutated at runtime to allow for easy experimentation.\n * For more information, see the {@link tweak} function.\n */\nexport type Tweak = number & _Tweak;\ninterface _Tweak {\n  get(): number;\n  set(v: number): void;\n  valueOf(): number;\n  toString(): string;\n  [Symbol.toPrimitive](hint: \"number\" | \"string\" | \"default\"): number | string;\n  onChange(func: OnTweakChangeFn): void;\n  initial: number;\n  name: string;\n  min: number;\n  max: number;\n  step: number;\n}\n\nexport interface TweakOptions {\n  /**\n   * The minimum value for the Tweak's slider. Defaults to 0.\n   */\n  min?: number,\n\n  /**\n   * The maximum value for the Tweak's slider. Defaults to 100.\n   */\n  max?: number,\n\n  /**\n   * The step value for the Tweak's slider. Defaults to 1.\n   */\n  step?: number,\n\n  /**\n   * The Tweaks object to attach the Tweak to. Defaults to `globalTweaks`.\n   */\n  tweaksObject?: Tweaks,\n}\n\nexport type OnTweakChangeFn = (newValue: number) => void;\n\n/**\n * Creates a `Tweak` and adds UI for it to be modified.\n *\n * A Tweak is a \"mutable number\"\u2014a value that coerces to a number in most\n * contexts but can be mutated at runtime to allow for easy experimentation.\n * Tweaks are automatically registered into a global {@link Tweaks} object and\n * given UI for changing its value. The experience is inspired by\n * [Dear ImGui](https://github.com/ocornut/imgui).\n *\n * A Tweak can be created using the {@link tweak} function:\n *\n *     const TWEAKY_CONSTANT = tweak(\"Tweak Name\", 3);\n *\n * This will create a Tweak with an initial value of 3, which can be used\n * anywhere a numeric constant would be used. Other options are available via\n * an optional third parameter, such as the ability to control the min and max\n * values or to register the Tweak with a different Tweaks object. See\n * {@link TweakOptions} for details.\n *\n * Two more steps are required to set your project up for tweaks:\n *\n * 1. Add the Tweaks UI to your page:\n *\n *        document.querySelector(\"body\").appendChild(window.tweaks.container);\n *\n * 2. Listen for changes to Tweaks and refresh your app accordingly:\n *\n *        window.addEventListener(\"tweak\", () => {\n *          updateAll();\n *        });\n *\n * Tweaks use `valueOf` and `Symbol.toPrimitive` so that they behave like\n * numbers when used in expressions. We do some TypeScript shenanigans to allow\n * the Tweak type to be used anywhere numbers are used. However, one big\n * annoyance is that exotic objects are always truthy, and the\n * [ToBoolean](https://262.ecma-international.org/8.0/#sec-toboolean) operation\n * doesn't allow for any hooks to modify this behavior. Attempting to use a\n * Tweak as a boolean value will therefore not work as expected. The easiest\n * workaround is to put a unary plus in front of the Tweak when using it, e.g.\n * `if (+DEBUG)`, in order to explicitly convert it to a number before\n * assessing its truthiness.\n */\nexport function tweak(name: string, initial: number, options: TweakOptions = {}): Tweak {\n  let value = initial;\n  const callbacks: OnTweakChangeFn[] = [];\n\n  const t: _Tweak = {\n    get(): number {\n      return value;\n    },\n\n    set(v: number) {\n      value = v;\n      for (const func of callbacks) {\n        func(value);\n      }\n    },\n\n    valueOf(): number {\n      return value;\n    },\n\n    toString(): string {\n      return String(value);\n    },\n\n    [Symbol.toPrimitive](hint: \"number\" | \"string\" | \"default\"): number | string {\n      if (hint === \"string\") {\n        return String(value);\n      }\n      return value;\n    },\n\n    onChange(func: OnTweakChangeFn) {\n      callbacks.push(func);\n    },\n\n    initial: initial,\n    name: name,\n    min: options.min ?? 0,\n    max: options.max ?? 100,\n    step: options.step ?? 1,\n  };\n\n  return (options.tweaksObject ?? globalTweaks).add(t as Tweak);\n}\n\nexport interface TweaksOptions {\n  /**\n   * The HTML element to render Tweaks into.\n   */\n  container: HTMLElement,\n}\n\nexport type OnTweakFn = (t: Tweak) => void;\n\n/**\n * A collection of Tweaks. By default, Tweaks will be registered with the\n * pre-existing {@link globalTweaks} object, which dispatches a \"tweak\" event\n * to `window` whenever a value is tweaked. Most of the time you should use\n * that instead of creating a new Tweaks object yourself.\n *\n * Each instance of Tweaks requires an HTML element to render into; you are\n * responsible for placing this container somewhere in the DOM. Subscribe to\n * changes by calling {@link onTweak}.\n */\nexport class Tweaks {\n  container: HTMLElement;\n  tweaks: Tweak[];\n  callbacks: OnTweakFn[];\n\n  constructor(options: TweaksOptions) {\n    this.container = options.container;\n    this.tweaks = [];\n    this.callbacks = [];\n  }\n\n  /**\n   * Adds a Tweak to this object. Not intended to be called directly; instead,\n   * just call {@link tweak} with the `tweaksObject` option.\n   */\n  add(tweak: Tweak): Tweak {\n    // Do not add the same tweak twice.\n    const existing = this.tweaks.find(t => t.name === tweak.name);\n    if (existing) {\n      return existing;\n    }\n\n    this.tweaks.push(tweak);\n\n    const el = document.createElement(\"div\");\n    this.container.appendChild(el);\n    el.style.display = \"flex\";\n    el.style.alignItems = \"center\";\n    el.style.justifyContent = \"end\";\n    el.style.gap = \"0.5rem\";\n\n    const safename = tweak.name.replace(/[a-zA-Z0-9]/g, \"_\");\n\n    const label = document.createElement(\"label\");\n    el.appendChild(label);\n    label.innerText = tweak.name;\n    label.htmlFor = `tweak-${safename}-input`;\n\n    const input = document.createElement(\"input\");\n    el.appendChild(input);\n    input.type = \"number\";\n    input.value = String(tweak);\n    input.id = `tweak-${safename}-input`;\n    input.style.width = \"4rem\";\n    input.addEventListener(\"input\", () => {\n      tweak.set(input.valueAsNumber);\n    });\n\n    const range = document.createElement(\"input\");\n    el.appendChild(range);\n    range.type = \"range\";\n    range.value = String(tweak);\n    range.min = String(tweak.min);\n    range.max = String(tweak.max);\n    range.step = tweak.step === 0 ? \"any\" : String(tweak.step);\n    range.addEventListener(\"input\", () => {\n      tweak.set(range.valueAsNumber);\n    });\n\n    const reset = document.createElement(\"button\");\n    el.appendChild(reset);\n    reset.innerText = \"Reset\";\n    reset.disabled = tweak.get() === tweak.initial;\n    reset.addEventListener(\"click\", () => {\n      tweak.set(tweak.initial);\n    });\n\n    tweak.onChange(v => {\n      input.value = String(v);\n      range.value = String(v);\n      reset.disabled = tweak.get() === tweak.initial;\n\n      for (const func of this.callbacks) {\n        func(tweak);\n      }\n    });\n\n    return tweak;\n  }\n\n  onTweak(func: OnTweakFn) {\n    this.callbacks.push(func);\n  }\n}\n\nconst globalContainer = document.createElement(\"div\");\nglobalContainer.classList.add(\"tweaks-panel\");\n\n/**\n * The default {@link Tweaks} object used by the {@link tweak} function.\n * Dispatches a \"tweak\" event to `window` whenever a value is tweaked. This\n * object can also be accessed via `window.tweaks`.\n */\nexport const globalTweaks = new Tweaks({ container: globalContainer });\nglobalTweaks.onTweak(t => {\n  window.dispatchEvent(new CustomEvent(\"tweak\", { detail: t }));\n});\n\n// @ts-ignore\nwindow.tweaks = globalTweaks;\n\n// Type system tests\nconst testContainer = document.createElement(\"div\");\nconst testTweaks = new Tweaks({ container: testContainer });\nlet testTweak = tweak(\"Test Value\", 3, { tweaksObject: testTweaks });\ntestTweak.set(4);\n// @ts-expect-error\ntestTweak = 4;\n", "import type { MIRBlock, LIRBlock, LIRInstruction, MIRInstruction, Pass, SampleCounts, BlockID, BlockPtr, InsPtr, InsID } from \"./iongraph.js\";\nimport { tweak } from \"./tweak.js\";\nimport { assert, clamp, filerp, must } from \"./utils.js\";\n\nconst DEBUG = tweak(\"Debug?\", 0, { min: 0, max: 1 });\n\nconst CONTENT_PADDING = 20;\nconst BLOCK_GAP = 44;\nconst PORT_START = 16;\nconst PORT_SPACING = 60;\nconst ARROW_RADIUS = 12;\nconst TRACK_PADDING = 36;\nconst JOINT_SPACING = 16;\nconst HEADER_ARROW_PUSHDOWN = 16;\nconst BACKEDGE_GAP = 40;\n\nconst LAYOUT_ITERATIONS = tweak(\"Layout Iterations\", 2, { min: 0, max: 6 });\nconst NEARLY_STRAIGHT = tweak(\"Nearly Straight Threshold\", 30, { min: 0, max: 200 });\nconst NEARLY_STRAIGHT_ITERATIONS = tweak(\"Nearly Straight Iterations\", 8, { min: 0, max: 10 });\nconst STOP_AT_PASS = tweak(\"Stop At Pass\", 30, { min: 0, max: 30 });\n\nconst ZOOM_SENSITIVITY = 1.50;\nconst WHEEL_DELTA_SCALE = 0.01;\nconst MAX_ZOOM = 1;\nconst MIN_ZOOM = 0.10;\nconst TRANSLATION_CLAMP_AMOUNT = 40;\n\nexport interface Vec2 {\n  x: number,\n  y: number,\n}\n\ntype Block = {\n  ptr: BlockPtr,\n  id: BlockID,\n  mir: MIRBlock,\n  lir: LIRBlock | null,\n\n  preds: Block[],\n  succs: Block[],\n  el: HTMLElement,\n  size: Vec2,\n  layer: number,\n  layoutNode: LayoutNode, // this is set partway through the process but trying to type it as such is absolutely not worth it\n\n  isLoopHeader: boolean,\n  isBackedge: boolean,\n  isRoot: boolean,\n  isOSRTarget: boolean,\n  isCatchEntrypoint: boolean,\n}\n\ntype LayoutNode = BlockNode | DummyNode;\n\ntype LayoutNodeID = number & { readonly __brand: \"LayoutNodeID\" };\n\ninterface _LayoutNodeCommon {\n  id: LayoutNodeID,\n  pos: Vec2,\n  size: Vec2,\n  srcNodes: LayoutNode[],\n  dstNodes: LayoutNode[],\n  jointOffsets: number[],\n  flags: NodeFlags,\n}\n\ntype BlockNode = _LayoutNodeCommon & {\n  block: Block,\n};\n\ntype DummyNode = _LayoutNodeCommon & {\n  block: null,\n  dstBlock: Block,\n};\n\ntype NodeFlags = number;\nconst LEFTMOST_DUMMY: NodeFlags = 1 << 0;\nconst RIGHTMOST_DUMMY: NodeFlags = 1 << 1;\nconst IMMINENT_BACKEDGE_DUMMY: NodeFlags = 1 << 2;\n\nexport const SC_TOTAL = 0;\nexport const SC_SELF = 1;\n\nconst log = new Proxy(console, {\n  get(target, prop: keyof Console) {\n    const field = target[prop];\n\n    if (typeof field !== \"function\") { // catches undefined too\n      return field;\n    }\n    return +DEBUG ? field.bind(target) : () => { };\n  }\n});\n\nexport interface GraphNavigation {\n  /** Chain of blocks visited by navigating up and down */\n  visited: BlockPtr[],\n\n  /** Current index into {@link visited} */\n  currentIndex: number,\n\n  /** Current set of sibling blocks to navigate sideways */\n  siblings: BlockPtr[],\n}\n\nexport interface HighlightedInstruction {\n  ptr: InsPtr,\n  paletteColor: number,\n}\n\nexport interface GraphState {\n  translation: Graph[\"translation\"],\n  zoom: Graph[\"zoom\"],\n  heatmapMode: Graph[\"heatmapMode\"],\n  highlightedInstructions: Graph[\"highlightedInstructions\"],\n  selectedBlockPtrs: Graph[\"selectedBlockPtrs\"],\n  lastSelectedBlockPtr: Graph[\"lastSelectedBlockPtr\"],\n\n  viewportPosOfSelectedBlock: Vec2 | undefined,\n}\n\nexport interface RestoreStateOpts {\n  preserveSelectedBlockPosition?: boolean,\n}\n\nexport interface GraphOptions {\n  /**\n   * Sample counts to display when viewing the LIR graph.\n   */\n  sampleCounts?: SampleCounts,\n\n  /**\n   * An array of CSS colors to use for highlighting instructions. You are\n   * encouraged to use CSS variables here.\n   */\n  instructionPalette?: string[],\n}\n\nexport class Graph {\n  //\n  // HTML elements\n  //\n  viewport: HTMLElement\n  viewportSize: Vec2;\n  graphContainer: HTMLElement;\n\n  //\n  // Core iongraph data\n  //\n  blocks: Block[];\n  blocksByID: Map<BlockID, Block>;\n  blocksByPtr: Map<BlockPtr, Block>;\n  insPtrsByID: Map<InsID, InsPtr>;\n  insIDsByPtr: Map<InsPtr, InsID>;\n\n  sampleCounts: SampleCounts | undefined;\n  maxSampleCounts: [number, number]; // [total, self]\n  heatmapMode: number; // SC_TOTAL or SC_SELF\n\n  //\n  // Post-layout info\n  //\n  size: Vec2;\n  numLayers: number;\n\n  //\n  // Pan and zoom\n  //\n  zoom: number;\n  translation: Vec2;\n\n  animating: boolean;\n  targetZoom: number;\n  targetTranslation: Readonly<Vec2>;\n\n  startMousePos: Readonly<Vec2>;\n  lastMousePos: Readonly<Vec2>;\n\n  //\n  // Block and instruction selection / navigation\n  //\n  selectedBlockPtrs: Set<BlockPtr>;\n  lastSelectedBlockPtr: BlockPtr; // 0 is treated as a null value\n  nav: GraphNavigation;\n\n  highlightedInstructions: HighlightedInstruction[];\n  instructionPalette: string[];\n\n  // Layout stabilization (two-pass layout approach)\n  stabilizationTimeout: number | null = null;\n  layoutFinalized: boolean = false;\n\n  // Deferred position restoration\n  deferredJumpToBlock: { blockPtr: BlockPtr, opts: { zoom?: number, animate?: boolean, viewportPos?: Vec2 } } | null = null;\n\n  constructor(viewport: HTMLElement, pass: Pass, options: GraphOptions = {}) {\n    this.viewport = viewport;\n    const viewportRect = viewport.getBoundingClientRect();\n    this.viewportSize = {\n      x: viewportRect.width,\n      y: viewportRect.height,\n    };\n\n    this.graphContainer = document.createElement(\"div\");\n    this.graphContainer.classList.add(\"ig-graph\");\n    this.graphContainer.style.transformOrigin = \"top left\";\n    this.viewport.appendChild(this.graphContainer);\n\n    this.sampleCounts = options.sampleCounts;\n    this.maxSampleCounts = [0, 0];\n    this.heatmapMode = SC_TOTAL;\n\n    for (const [ins, count] of this.sampleCounts?.totalLineHits ?? []) {\n      this.maxSampleCounts[SC_TOTAL] = Math.max(this.maxSampleCounts[SC_TOTAL], count);\n    }\n    for (const [ins, count] of this.sampleCounts?.selfLineHits ?? []) {\n      this.maxSampleCounts[SC_SELF] = Math.max(this.maxSampleCounts[SC_SELF], count);\n    }\n\n    this.size = { x: 0, y: 0 };\n    this.numLayers = 0;\n\n    this.zoom = 1;\n    this.translation = { x: 0, y: 0 };\n\n    this.animating = false;\n    this.targetZoom = 1;\n    this.targetTranslation = { x: 0, y: 0 };\n\n    this.startMousePos = { x: 0, y: 0 };\n    this.lastMousePos = { x: 0, y: 0 };\n\n    this.selectedBlockPtrs = new Set();\n    this.lastSelectedBlockPtr = 0 as BlockPtr;\n    this.nav = {\n      visited: [],\n      currentIndex: -1,\n      siblings: [],\n    };\n\n    this.highlightedInstructions = [];\n    this.instructionPalette = options.instructionPalette ?? [0, 1, 2, 3, 4].map(n => `var(--ig-highlight-${n})`);\n\n    this.blocks = pass.mir.blocks.map(m => {\n      const block: Block = {\n        ptr: m.ptr,\n        id: m.id,\n        mir: m,\n        lir: pass.lir.blocks.find(l => l.id === m.id) ?? null,\n\n        preds: [],\n        succs: [],\n        el: undefined as unknown as HTMLElement, // set below in constructor\n        size: { x: 0, y: 0 },\n        layer: -1,\n        layoutNode: undefined as unknown as LayoutNode, // set in makeLayoutNodes\n        isLoopHeader: false,\n        isBackedge: false,\n        isRoot: false,\n        isOSRTarget: false,\n        isCatchEntrypoint: false,\n      };\n\n      assert(block.ptr, \"blocks must always have non-null ptrs\");\n      return block;\n    });\n    this.blocksByID = new Map();\n    this.blocksByPtr = new Map();\n    this.insPtrsByID = new Map();\n    this.insIDsByPtr = new Map();\n\n    // Initialize maps\n    for (const block of this.blocks) {\n      this.blocksByID.set(block.id, block);\n      this.blocksByPtr.set(block.ptr, block);\n      for (const ins of block.mir.instructions) {\n        // TODO: This is kind of jank because it will overwrite MIR\n        // instructions that were also there. But we never render those, so\n        // it's basically moot.\n        this.insPtrsByID.set(ins.id, ins.ptr);\n        this.insIDsByPtr.set(ins.ptr, ins.id);\n      }\n\n      if (block.lir) {\n        for (const ins of block.lir.instructions) {\n          this.insPtrsByID.set(ins.id, ins.ptr);\n          this.insIDsByPtr.set(ins.ptr, ins.id);\n        }\n      }\n    }\n\n    // After putting all blocks in our maps, fill out block-to-block references.\n    for (const block of this.blocks) {\n      block.preds = block.mir.predecessors.map(id => must(this.blocksByID.get(id)));\n      block.succs = block.mir.successors.map(id => must(this.blocksByID.get(id)));\n      block.isRoot = block.preds.length === 0;\n      block.isOSRTarget = block.mir.attributes.includes(\"osr\");\n      block.isCatchEntrypoint = block.mir.attributes.includes(\"catch\");\n    }\n\n    // Compute layers and detect cycles before creating elements\n    // This ensures isLoopHeader/isBackedge flags are set before renderBlock()\n    this.assignLayers();\n\n    // Create and measure all blocks\n    for (const block of this.blocks) {\n      block.el = this.renderBlock(block);\n    }\n\n    // Compute sizes for all blocks. We do this after rendering all blocks so\n    // that layout isn't constantly invalidated by adding new blocks.\n    //\n    // (Although, it's super bullshit that we have to do this, because all of\n    // the blocks are absolutely positioned and therefore have zero impact on\n    // any others. Adding another block to the page should not invalidate all\n    // the layout properties of all the others! We should not see an 85%\n    // speedup just from moving this out of the first loop, but we do!)\n    for (const block of this.blocks) {\n      block.size = {\n        x: block.el.offsetWidth,\n        y: block.el.offsetHeight,\n      };\n    }\n\n    // Run initial layout\n    this.runLayout();\n\n    // Schedule a single re-layout after tables settle (100ms debounce)\n    // This catches any late size adjustments from table layout\n    // Because WebKit / blink does multi-pass layout for tables, the layout\n    // can change after the first layout. So we continue doing re-layout until\n    // the result converges.\n    this.stabilizationTimeout = window.setTimeout(() => {\n      this.stabilizationTimeout = null;\n\n      // Re-measure all blocks\n      let changed = false;\n      for (const block of this.blocks) {\n        const w = block.el.offsetWidth;\n        const h = block.el.offsetHeight;\n        if (Math.abs(block.size.x - w) > 1 || Math.abs(block.size.y - h) > 1) {\n          block.size = { x: w, y: h };\n          changed = true;\n        }\n      }\n      if (changed) {\n        this.runLayout();\n      }\n      this.layoutFinalized = true;\n      log.log(\"Graph layout finalized.\");\n    }, 100);\n\n    this.addEventListeners();\n  }\n\n  private runLayout() {\n      const [nodesByLayer, layerHeights, trackHeights] = this.layout();\n\n      const children = Array.from(this.graphContainer.children);\n      for (const child of children) {\n          if (!child.classList.contains(\"ig-block\")) {\n              child.remove();\n          }\n      }\n\n      this.render(nodesByLayer, layerHeights, trackHeights);\n\n      // Execute deferred position restoration after layout\n      if (this.deferredJumpToBlock) {\n          const { blockPtr, opts } = this.deferredJumpToBlock;\n          this.deferredJumpToBlock = null;\n          this.jumpToBlock(blockPtr, opts);\n      }\n  }\n\n  private layout(): [LayoutNode[][], number[], number[]] {\n    const layoutNodesByLayer = this.makeLayoutNodes();\n\n    this.straightenEdges(layoutNodesByLayer);\n    const trackHeights = this.finagleJoints(layoutNodesByLayer);\n    const layerHeights = this.verticalize(layoutNodesByLayer, trackHeights);\n\n    return [layoutNodesByLayer, layerHeights, trackHeights];\n  }\n\n  private findLayoutRoots(): [Block[], Block[]] {\n    const newRoots: Block[] = [];\n    const osrBlocks: Block[] = [];\n    const roots = this.blocks.filter(b => b.preds.length === 0);\n\n    for (const root of roots) {\n       newRoots.push(root);\n       if (root.mir.attributes.includes(\"osr\")) {\n           osrBlocks.push(root);\n       }\n    }\n    if (newRoots.length === 0 && this.blocks.length > 0) {\n        const sorted = [...this.blocks].sort((a,b) => a.id - b.id);\n        newRoots.push(sorted[0]);\n    }\n    return [newRoots, osrBlocks];\n  }\n\n  private detectCycles(): Map<Block, Set<Block>> {\n      const visited = new Map<Block, number>();\n      const isBackedge = new Map<Block, Set<Block>>();\n\n      const detect = (u: Block) => {\n          visited.set(u, 1);\n          for (const v of u.succs) {\n              const status = visited.get(v) ?? 0;\n              if (status === 1) {\n                  let s = isBackedge.get(u);\n                  if (!s) { s = new Set(); isBackedge.set(u, s); }\n                  s.add(v);\n                  u.isBackedge = true;\n                  v.isLoopHeader = true;\n              } else if (status === 0) {\n                  detect(v);\n              }\n          }\n          visited.set(u, 2);\n      };\n\n      for (const b of this.blocks) {\n          if (!visited.has(b)) detect(b);\n      }\n\n      return isBackedge;\n  }\n\n  private assignLayers() {\n      const isBackedge = this.detectCycles();\n\n      for (const b of this.blocks) b.layer = -1;\n\n      const computeLayer = (u: Block): number => {\n          if (u.layer !== -1) return u.layer;\n\n          let maxParentLayer = -1;\n          for (const p of u.preds) {\n              const pBackedges = isBackedge.get(p);\n              if (pBackedges && pBackedges.has(u)) continue;\n\n              const pl = computeLayer(p);\n              if (pl > maxParentLayer) maxParentLayer = pl;\n          }\n\n          u.layer = maxParentLayer + 1;\n          return u.layer;\n      };\n\n      let maxLayer = 0;\n      for (const b of this.blocks) {\n          const l = computeLayer(b);\n          if (l > maxLayer) maxLayer = l;\n      }\n      this.numLayers = maxLayer + 1;\n      log.log(`Assigned generic layers. Max layer: ${maxLayer}`);\n  }\n\n  private makeLayoutNodes(): LayoutNode[][] {\n    log.group(\"makeLayoutNodes\");\n\n    function connectNodes(from: LayoutNode, fromPort: number, to: LayoutNode) {\n      from.dstNodes[fromPort] = to;\n      if (!to.srcNodes.includes(from)) {\n        to.srcNodes.push(from);\n      }\n    }\n\n    let blocksByLayer: Block[][];\n    {\n      const blocksByLayerObj: { [layer: number]: Block[] } = {};\n      for (const block of this.blocks) {\n        const l = block.layer < 0 ? 0 : block.layer;\n        if (!blocksByLayerObj[l]) {\n          blocksByLayerObj[l] = [];\n        }\n        blocksByLayerObj[l].push(block);\n      }\n      blocksByLayer = Object.entries(blocksByLayerObj)\n        .map(([layer, blocks]) => [Number(layer), blocks] as const)\n        .sort((a, b) => a[0] - b[0])\n        .map(([_, blocks]) => blocks);\n    }\n\n    const denseBlocksByLayer: Block[][] = [];\n    for(let i=0; i<this.numLayers; i++) {\n        denseBlocksByLayer[i] = blocksByLayer.find(b => b[0]?.layer === i) || [];\n    }\n\n    type IncompleteEdge = {\n      src: LayoutNode,\n      srcPort: number,\n      dstBlock: Block,\n    };\n\n    let nodeID = 0 as LayoutNodeID;\n    const layoutNodesByLayer: LayoutNode[][] = denseBlocksByLayer.map(() => []);\n    const activeForwardEdges: IncompleteEdge[] = [];\n\n    for (const [layer, blocks] of denseBlocksByLayer.entries()) {\n      const terminatingEdges: IncompleteEdge[] = [];\n      for (const block of blocks) {\n        for (let i = activeForwardEdges.length - 1; i >= 0; i--) {\n          const edge = activeForwardEdges[i];\n          if (edge.dstBlock === block) {\n            terminatingEdges.unshift(edge);\n            activeForwardEdges.splice(i, 1);\n          }\n        }\n      }\n\n      const dummiesByDest: Map<number, DummyNode> = new Map();\n      for (const edge of activeForwardEdges) {\n          let dummy = dummiesByDest.get(edge.dstBlock.id);\n          if (dummy) {\n              connectNodes(edge.src, edge.srcPort, dummy);\n          } else {\n              dummy = {\n                  id: nodeID++ as LayoutNodeID,\n                  pos: { x: CONTENT_PADDING, y: CONTENT_PADDING },\n                  size: { x: 0, y: 0 },\n                  block: null,\n                  srcNodes: [],\n                  dstNodes: [],\n                  dstBlock: edge.dstBlock,\n                  jointOffsets: [],\n                  flags: 0,\n              };\n              connectNodes(edge.src, edge.srcPort, dummy);\n              layoutNodesByLayer[layer].push(dummy);\n              dummiesByDest.set(edge.dstBlock.id, dummy);\n          }\n          edge.src = dummy;\n          edge.srcPort = 0;\n      }\n\n      for (const block of blocks) {\n        const node: BlockNode = {\n          id: nodeID++ as LayoutNodeID,\n          pos: { x: CONTENT_PADDING, y: CONTENT_PADDING },\n          size: block.size,\n          block: block,\n          srcNodes: [],\n          dstNodes: [],\n          jointOffsets: [],\n          flags: 0,\n        };\n        block.layoutNode = node;\n        layoutNodesByLayer[layer].push(node);\n\n        for (const edge of terminatingEdges) {\n            if (edge.dstBlock === block) {\n                connectNodes(edge.src, edge.srcPort, node);\n            }\n        }\n      }\n\n      for (const block of blocks) {\n          block.succs.forEach((succ, portIndex) => {\n              if (succ.layer > layer) {\n                  if (succ.layer === layer + 1) {\n                      activeForwardEdges.push({ src: block.layoutNode, srcPort: portIndex, dstBlock: succ });\n                  } else {\n                      activeForwardEdges.push({ src: block.layoutNode, srcPort: portIndex, dstBlock: succ });\n                  }\n              } else {\n                  // Backedge or same-layer edge (Cycle): Route via dummy chain to the right\n                  let currentLayer = layer;\n                  let targetLayer = succ.layer;\n\n                  let prevNode: LayoutNode = block.layoutNode;\n                  let prevPort = portIndex;\n\n                  for (let l = currentLayer; l >= targetLayer; l--) {\n                      const dummy: DummyNode = {\n                          id: nodeID++ as LayoutNodeID,\n                          pos: { x: CONTENT_PADDING, y: CONTENT_PADDING },\n                          size: { x: 0, y: 0 },\n                          block: null,\n                          srcNodes: [],\n                          dstNodes: [],\n                          dstBlock: succ,\n                          jointOffsets: [],\n                          flags: IMMINENT_BACKEDGE_DUMMY,\n                      };\n\n                      layoutNodesByLayer[l].push(dummy);\n\n                      connectNodes(prevNode, prevPort, dummy);\n\n                      prevNode = dummy;\n                      prevPort = 0;\n                  }\n\n                  if (succ.layoutNode) {\n                      connectNodes(prevNode, prevPort, succ.layoutNode);\n                  }\n              }\n          });\n      }\n    }\n\n    // Mark dummies\n    for (const nodes of layoutNodesByLayer) {\n      for (let i = 0; i < nodes.length; i++) {\n        if (nodes[i].block === null) {\n          nodes[i].flags |= LEFTMOST_DUMMY;\n        } else {\n          break;\n        }\n      }\n      for (let i = nodes.length - 1; i >= 0; i--) {\n        if (nodes[i].block === null) {\n          nodes[i].flags |= RIGHTMOST_DUMMY;\n        } else {\n          break;\n        }\n      }\n    }\n\n    log.groupEnd();\n    return layoutNodesByLayer;\n  }\n\n  private straightenEdges(layoutNodesByLayer: LayoutNode[][]) {\n    // Push nodes to the right if they are too close together.\n    const pushNeighbors = (nodes: LayoutNode[]) => {\n      for (let i = 0; i < nodes.length - 1; i++) {\n        const node = nodes[i];\n        const neighbor = nodes[i + 1];\n\n        const firstNonDummy = node.block === null && neighbor.block !== null;\n        const nodeRightPlusPadding = node.pos.x + node.size.x + (firstNonDummy ? PORT_START : 0) + BLOCK_GAP;\n        neighbor.pos.x = Math.max(neighbor.pos.x, nodeRightPlusPadding);\n      }\n    };\n\n    const straightenDummyRuns = () => {\n      // Track max position of dummies\n      const dummyLinePositions = new Map<Block, number>();\n      for (const dummy of dummies(layoutNodesByLayer)) {\n        const dst = dummy.dstBlock;\n        let desiredX = dummy.pos.x;\n        dummyLinePositions.set(dst, Math.max(dummyLinePositions.get(dst) ?? 0, desiredX));\n      }\n\n      // Apply positions to dummies\n      for (const dummy of dummies(layoutNodesByLayer)) {\n        const backedge = dummy.dstBlock;\n        const x = dummyLinePositions.get(backedge);\n        if(x) dummy.pos.x = x;\n      }\n      for (const nodes of layoutNodesByLayer) {\n        pushNeighbors(nodes);\n      }\n    };\n\n    const suckInLeftmostDummies = () => {\n      // Break leftmost dummy runs by pulling them as far right as possible\n      // (but never pulling any node to the right of its parent, or its\n      // ultimate destination block). Track the min position for each\n      // destination as we go.\n      const dummyRunPositions = new Map<Block, number>();\n      for (const nodes of layoutNodesByLayer) {\n        // Find leftmost non-dummy node\n        let i = 0;\n        let nextX = 0;\n        for (; i < nodes.length; i++) {\n          if (!(nodes[i].flags & LEFTMOST_DUMMY)) {\n            nextX = nodes[i].pos.x;\n            break;\n          }\n        }\n\n        // Walk backward through leftmost dummies, calculating how far to the\n        // right we can push them.\n        i -= 1;\n        nextX -= BLOCK_GAP + PORT_START;\n        for (; i >= 0; i--) {\n          const dummy = nodes[i] as DummyNode;\n          let maxSafeX = nextX;\n          // Don't let dummies go to the right of their source nodes.\n          for (const src of dummy.srcNodes) {\n            const srcX = src.pos.x + src.dstNodes.indexOf(dummy) * PORT_SPACING;\n            if (srcX < maxSafeX) {\n              maxSafeX = srcX;\n            }\n          }\n          dummy.pos.x = maxSafeX;\n          nextX = dummy.pos.x - BLOCK_GAP;\n          dummyRunPositions.set(dummy.dstBlock, Math.min(dummyRunPositions.get(dummy.dstBlock) ?? Infinity, maxSafeX));\n        }\n      }\n\n      // Apply min positions to all dummies in a run.\n      for (const dummy of dummies(layoutNodesByLayer)) {\n        if (!(dummy.flags & LEFTMOST_DUMMY)) continue;\n        const x = dummyRunPositions.get(dummy.dstBlock);\n        if(x) dummy.pos.x = x;\n      }\n    };\n\n    // Walk down the layers, pulling children to the right to line up with\n    // their parents.\n    const straightenChildren = () => {\n      for (let layer = 0; layer < layoutNodesByLayer.length - 1; layer++) {\n        const nodes = layoutNodesByLayer[layer];\n        pushNeighbors(nodes);\n\n        // If a node has been shifted, we must never shift any node to its\n        // left. This preserves stable graph layout and just avoids lots of\n        // jank. We also only shift a child based on its first parent, because\n        // otherwide nodes end up being pulled too far to the right.\n        let lastShifted = -1;\n        for (const node of nodes) {\n          for (const [srcPort, dst] of node.dstNodes.entries()) {\n            if (!layoutNodesByLayer[layer + 1].includes(dst)) continue;\n\n            let dstIndexInNextLayer = layoutNodesByLayer[layer + 1].indexOf(dst);\n            if (dstIndexInNextLayer > lastShifted && dst.srcNodes[0] === node) {\n              const srcPortOffset = PORT_START + PORT_SPACING * srcPort;\n              const dstPortOffset = PORT_START;\n              let xBefore = dst.pos.x;\n              dst.pos.x = Math.max(dst.pos.x, node.pos.x + srcPortOffset - dstPortOffset);\n              if (dst.pos.x !== xBefore) {\n                lastShifted = dstIndexInNextLayer;\n              }\n            }\n          }\n        }\n      }\n    };\n\n    // Walk each layer right to left, pulling nodes to the right to line them\n    // up with their parents and children as well as possible, but WITHOUT ever\n    // causing another overlap and therefore any need to push neighbors.\n    //\n    // (The exception is rightmost dummies; we push those because we can\n    // trivially straighten them later.)\n    const straightenConservative = () => {\n      for (const nodes of layoutNodesByLayer) {\n        for (let i = nodes.length - 1; i >= 0; i--) {\n          const node = nodes[i];\n          if (!node.block || node.block.isLoopHeader) continue;\n\n          let deltasToTry: number[] = [];\n          for (const parent of node.srcNodes) {\n            const srcPortOffset = PORT_START + parent.dstNodes.indexOf(node) * PORT_SPACING;\n            const dstPortOffset = PORT_START;\n            deltasToTry.push((parent.pos.x + srcPortOffset) - (node.pos.x + dstPortOffset));\n          }\n          for (const [srcPort, dst] of node.dstNodes.entries()) {\n            if (dst.block === null && dst.dstBlock.isLoopHeader) continue;\n            const srcPortOffset = PORT_START + srcPort * PORT_SPACING;\n            const dstPortOffset = PORT_START;\n            deltasToTry.push((dst.pos.x + dstPortOffset) - (node.pos.x + srcPortOffset));\n          }\n          if (deltasToTry.includes(0)) continue;\n          deltasToTry = deltasToTry.filter(d => d > 0).sort((a, b) => a - b);\n\n          for (const delta of deltasToTry) {\n            let overlapsAny = false;\n            for (let j = i + 1; j < nodes.length; j++) {\n              const other = nodes[j];\n              if (other.flags & RIGHTMOST_DUMMY) continue;\n              const a1 = node.pos.x + delta, a2 = node.pos.x + delta + node.size.x;\n              const b1 = other.pos.x - BLOCK_GAP, b2 = other.pos.x + other.size.x + BLOCK_GAP;\n              const overlaps = a2 >= b1 && a1 <= b2;\n              if (overlaps) overlapsAny = true;\n            }\n            if (!overlapsAny) {\n              node.pos.x += delta;\n              break;\n            }\n          }\n        }\n        pushNeighbors(nodes);\n      }\n    };\n\n    // Walk up the layers, straightening out edges that are nearly straight.\n    const straightenNearlyStraightEdgesUp = () => {\n      for (let layer = layoutNodesByLayer.length - 1; layer >= 0; layer--) {\n        const nodes = layoutNodesByLayer[layer];\n        pushNeighbors(nodes);\n        for (const node of nodes) {\n          for (const src of node.srcNodes) {\n            if (src.block !== null) continue;\n            const wiggle = Math.abs(src.pos.x - node.pos.x);\n            if (wiggle <= NEARLY_STRAIGHT) {\n              src.pos.x = Math.max(src.pos.x, node.pos.x);\n              node.pos.x = Math.max(src.pos.x, node.pos.x);\n            }\n          }\n        }\n      }\n    };\n\n    // Ditto, but walking down instead of up.\n    const straightenNearlyStraightEdgesDown = () => {\n      for (let layer = 0; layer < layoutNodesByLayer.length; layer++) {\n        const nodes = layoutNodesByLayer[layer];\n        pushNeighbors(nodes);\n        for (const node of nodes) {\n          if (node.dstNodes.length === 0) continue;\n          const dst = node.dstNodes[0];\n          if (dst.block !== null) continue;\n          const wiggle = Math.abs(dst.pos.x - node.pos.x);\n          if (wiggle <= NEARLY_STRAIGHT) {\n            dst.pos.x = Math.max(dst.pos.x, node.pos.x);\n            node.pos.x = Math.max(dst.pos.x, node.pos.x);\n          }\n        }\n      }\n    };\n\n    function repeat<T>(a: T[], n: number): T[] {\n      const result: T[] = [];\n      for (let i = 0; i < n; i++) {\n        for (const item of a) result.push(item);\n      }\n      return result;\n    }\n\n    // The order of these passes is arbitrary. I just play with it until I like\n    // the result. I have them in this wacky structure because I want to be\n    // able to use my debug scrubber\n    const passes = [\n      ...repeat([\n        straightenChildren,\n        straightenDummyRuns,\n      ], LAYOUT_ITERATIONS),\n      straightenDummyRuns,\n      ...repeat([\n        straightenNearlyStraightEdgesUp,\n        straightenNearlyStraightEdgesDown,\n      ], NEARLY_STRAIGHT_ITERATIONS),\n      straightenConservative,\n      straightenDummyRuns,\n      suckInLeftmostDummies,\n    ];\n\n    for (const [i, pass] of passes.entries()) {\n      if (i < STOP_AT_PASS) {\n        pass();\n      }\n    }\n  }\n\n  private finagleJoints(layoutNodesByLayer: LayoutNode[][]): number[] {\n    interface Joint {\n      x1: number,\n      x2: number,\n      src: LayoutNode,\n      srcPort: number,\n      dst: LayoutNode,\n    }\n\n    const trackHeights: number[] = [];\n\n    for (const nodes of layoutNodesByLayer) {\n      // Get all joints into a list, and sort them left to right by their\n      // starting coordinate. This produces the nicest visual nesting.\n      const joints: Joint[] = [];\n      for (const node of nodes) {\n        node.jointOffsets = new Array(node.dstNodes.length).fill(0);\n\n        for (const [srcPort, dst] of node.dstNodes.entries()) {\n           if (dst.pos.y < node.pos.y) continue;\n\n          const x1 = node.pos.x + PORT_START + PORT_SPACING * srcPort;\n          const x2 = dst.pos.x + PORT_START;\n          if (Math.abs(x2 - x1) < 2 * ARROW_RADIUS) continue;\n          joints.push({ x1, x2, src: node, srcPort, dst });\n        }\n      }\n      joints.sort((a, b) => a.x1 - b.x1);\n\n      // Greedily sort joints into \"tracks\" based on whether they overlap\n      // horizontally with each other. We walk the tracks from the outside in\n      // and place the joint in the innermost possible track, stopping if we\n      // ever overlap with any other joint.\n      const rightwardTracks: Joint[][] = [];\n      const leftwardTracks: Joint[][] = [];\n      nextJoint:\n      for (const joint of joints) {\n        const trackSet = joint.x2 - joint.x1 >= 0 ? rightwardTracks : leftwardTracks;\n        let lastValidTrack: Joint[] | null = null;\n        for (let i = trackSet.length - 1; i >= 0; i--) {\n          const track = trackSet[i];\n          let overlapsWithAnyInThisTrack = false;\n          for (const otherJoint of track) {\n            if (joint.dst === otherJoint.dst) {\n              // Assign the joint to this track to merge arrows\n              track.push(joint);\n              continue nextJoint;\n            }\n\n            const al = Math.min(joint.x1, joint.x2), ar = Math.max(joint.x1, joint.x2);\n            const bl = Math.min(otherJoint.x1, otherJoint.x2), br = Math.max(otherJoint.x1, otherJoint.x2);\n            const overlaps = ar >= bl && al <= br;\n            if (overlaps) {\n              overlapsWithAnyInThisTrack = true;\n              break;\n            }\n          }\n\n          if (overlapsWithAnyInThisTrack) {\n            break;\n          } else {\n            lastValidTrack = track;\n          }\n        }\n\n        if (lastValidTrack) {\n          lastValidTrack.push(joint);\n        } else {\n          trackSet.push([joint]);\n        }\n      }\n\n      // Use track info to apply joint offsets to nodes for rendering.\n      // We\n      const tracksHeight = Math.max(0, rightwardTracks.length + leftwardTracks.length - 1) * JOINT_SPACING;\n      let trackOffset = -tracksHeight / 2;\n      for (const track of [...rightwardTracks.reverse(), ...leftwardTracks]) {\n        for (const joint of track) {\n          joint.src.jointOffsets[joint.srcPort] = trackOffset;\n        }\n        trackOffset += JOINT_SPACING;\n      }\n\n      trackHeights.push(tracksHeight);\n    }\n\n    return trackHeights;\n  }\n\n  private verticalize(layoutNodesByLayer: LayoutNode[][], trackHeights: number[]): number[] {\n    const layerHeights: number[] = new Array(layoutNodesByLayer.length);\n\n    let nextLayerY = CONTENT_PADDING;\n    for (let i = 0; i < layoutNodesByLayer.length; i++) {\n      const nodes = layoutNodesByLayer[i];\n\n      let layerHeight = 0;\n      for (const node of nodes) {\n        node.pos.y = nextLayerY;\n        layerHeight = Math.max(layerHeight, node.size.y);\n      }\n\n      layerHeights[i] = layerHeight;\n      nextLayerY += layerHeight + TRACK_PADDING + trackHeights[i] + TRACK_PADDING;\n    }\n\n    return layerHeights;\n  }\n\n  private renderBlock(block: Block): HTMLElement {\n    const el = document.createElement(\"div\");\n    this.graphContainer.appendChild(el);\n    el.classList.add(\"ig-block\", \"ig-bg-white\");\n    for (const att of block.mir.attributes) {\n      el.classList.add(`ig-block-att-${att}`);\n    }\n    el.setAttribute(\"data-ig-block-ptr\", `${block.ptr}`);\n    el.setAttribute(\"data-ig-block-id\", `${block.id}`);\n\n    let desc : String[] = [];\n\n    if (block.isRoot) {\n      desc.push(\"(root)\");\n      el.classList.add(`ig-block-att-root`);\n    }\n\n    if (block.isCatchEntrypoint) {\n      desc.push(\"(catch)\");\n    }\n\n    if (block.isOSRTarget) {\n      desc.push(\"(osr)\");\n    }\n\n    if (block.isLoopHeader) {\n      desc.push(\"(loop header)\");\n      el.classList.add(`ig-block-att-loopheader`);\n    }\n\n    if (block.isBackedge) {\n      desc.push(\"(backedge)\");\n      el.classList.add(`ig-block-att-backedge`);\n    }\n\n    const header = document.createElement(\"div\");\n    header.classList.add(\"ig-block-header\");\n    header.innerText = `Block ${block.id}${desc.length === 0 ? '' : ' ' + desc.join(' ')}`;\n    el.appendChild(header);\n\n    const insnsContainer = document.createElement(\"div\");\n    insnsContainer.classList.add(\"ig-instructions\");\n    el.appendChild(insnsContainer);\n\n    const insns = document.createElement(\"table\");\n    if (block.lir) {\n      insns.innerHTML = `\n        <colgroup>\n          <col style=\"width: 1px\">\n          <col style=\"width: auto\">\n          ${this.sampleCounts ? `\n            <col style=\"width: 1px\">\n            <col style=\"width: 1px\">\n          ` : \"\"}\n        </colgroup>\n        ${this.sampleCounts ? `\n          <thead>\n            <tr>\n              <th></th>\n              <th></th>\n              <th class=\"ig-f6\">Total</th>\n              <th class=\"ig-f6\">Self</th>\n            </tr>\n          </thead>\n        ` : \"\"}\n      `;\n      for (const ins of block.lir.instructions) {\n        insns.appendChild(this.renderLIRInstruction(ins));\n      }\n    } else {\n      insns.innerHTML = `\n        <colgroup>\n          <col style=\"width: 1px\">\n          <col style=\"width: auto\">\n          <col style=\"width: 1px\">\n        </colgroup>\n      `;\n      for (const ins of block.mir.instructions) {\n        insns.appendChild(this.renderMIRInstruction(ins));\n      }\n    }\n    insnsContainer.appendChild(insns);\n\n    // Show edge labels with target block numbers\n    for (const [i, succ] of block.succs.entries()) {\n      const edgeLabel = document.createElement(\"div\");\n      edgeLabel.innerText = `#${succ.id}`;\n      edgeLabel.classList.add(\"ig-edge-label\");\n      edgeLabel.style.left = `${PORT_START + PORT_SPACING * i}px`;\n      el.appendChild(edgeLabel);\n    }\n\n    // Attach event handlers\n    header.addEventListener(\"pointerdown\", e => {\n      e.preventDefault();\n      e.stopPropagation();\n    });\n    header.addEventListener(\"click\", e => {\n      e.stopPropagation();\n      if (!e.shiftKey) {\n        this.selectedBlockPtrs.clear();\n      }\n      this.setSelection([], block.ptr);\n    });\n\n    return el;\n  }\n\n  private render(nodesByLayer: LayoutNode[][], layerHeights: number[], trackHeights: number[]) {\n    // Position blocks according to layout\n    for (const nodes of nodesByLayer) {\n      for (const node of nodes) {\n        if (node.block !== null) {\n          const block = node.block;\n          block.el.style.left = `${node.pos.x}px`;\n          block.el.style.top = `${node.pos.y}px`;\n        }\n      }\n    }\n\n    // Create and size the SVG\n    let maxX = 0, maxY = 0;\n    for (const nodes of nodesByLayer) {\n      for (const node of nodes) {\n        maxX = Math.max(maxX, node.pos.x + node.size.x + CONTENT_PADDING);\n        maxY = Math.max(maxY, node.pos.y + node.size.y + CONTENT_PADDING);\n      }\n    }\n    const svg = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\n    this.graphContainer.appendChild(svg);\n\n    const trackPositions = (xs: number[], ys: number[]) => {\n      for (const x of xs) maxX = Math.max(maxX, x + CONTENT_PADDING);\n      for (const y of ys) maxY = Math.max(maxY, y + CONTENT_PADDING);\n    };\n\n    // Render arrows\n    for (let layer = 0; layer < nodesByLayer.length; layer++) {\n      const nodes = nodesByLayer[layer];\n      for (const node of nodes) {\n        assert(node.dstNodes.length === node.jointOffsets.length, \"must have a joint offset for each destination\");\n\n        for (const [i, dst] of node.dstNodes.entries()) {\n          const x1 = node.pos.x + PORT_START + PORT_SPACING * i;\n          let y1 = node.pos.y + node.size.y;\n          const x2 = dst.pos.x + PORT_START;\n          let y2 = dst.pos.y;\n\n          const isUpward = y2 < y1;\n          const isBackedgeDummyChain = (n: LayoutNode) => (n.flags & IMMINENT_BACKEDGE_DUMMY) !== 0;\n\n          if (node.block && dst.block === null && isUpward) {\n              // Block -> Dummy (Backedge start)\n              const ym = y1 + TRACK_PADDING;\n              const arrow = arrowFromBlockToBackedgeDummy(x1, y1, x2, y2, ym);\n              svg.appendChild(arrow);\n              trackPositions([x1, x2], [y1, y2, ym]);\n          } else if (node.block === null && dst.block !== null && Math.abs(y1 - y2) < 1) {\n              // Dummy -> Block (Backedge end)\n              // Go up, then left, then down to block\n              const yHigh = y2 - BACKEDGE_GAP;\n              const arrow = arrowBackedgeEnd(x1, y1, x2, y2, yHigh);\n              svg.appendChild(arrow);\n              trackPositions([x1, x2], [y1, y2, yHigh]);\n          } else if (isUpward) {\n              // Dummy -> Dummy\n              const ym = y1 - TRACK_PADDING;\n              const arrow = upwardArrow(x1, y1, x2, y2, ym, dst.block !== null);\n              svg.appendChild(arrow);\n              trackPositions([x1, x2], [y1, y2, ym]);\n          } else {\n            // Forward Edge\n            const ym = (y1 - node.size.y) + layerHeights[layer] + TRACK_PADDING + trackHeights[layer] / 2 + node.jointOffsets[i];\n            const arrow = downwardArrow(x1, y1, x2, y2, ym, dst.block !== null);\n            svg.appendChild(arrow);\n            trackPositions([x1, x2], [y1, y2, ym]);\n          }\n        }\n      }\n    }\n\n    svg.setAttribute(\"width\", `${maxX}`);\n    svg.setAttribute(\"height\", `${maxY}`);\n    this.size = { x: maxX, y: maxY };\n\n    // Render debug nodes\n    if (+DEBUG) {\n      for (const nodes of nodesByLayer) {\n        for (const node of nodes) {\n          const el = document.createElement(\"div\");\n          // Build debug info safely using DOM APIs\n          el.appendChild(document.createTextNode(String(node.id)));\n          el.appendChild(document.createElement(\"br\"));\n          el.appendChild(document.createTextNode(`L:${node.block?.layer}`));\n          el.appendChild(document.createElement(\"br\"));\n          el.appendChild(document.createTextNode(`<- ${node.srcNodes.map(n => n.id)}`));\n          el.appendChild(document.createElement(\"br\"));\n          el.appendChild(document.createTextNode(`-> ${node.dstNodes.map(n => n.id)}`));\n          el.style.position = \"absolute\";\n          el.style.border = \"1px solid black\";\n          el.style.backgroundColor = \"white\";\n          el.style.left = `${node.pos.x}px`;\n          el.style.top = `${node.pos.y}px`;\n          el.style.whiteSpace = \"nowrap\";\n          this.graphContainer.appendChild(el);\n        }\n      }\n    }\n\n    // Final rendering of other effects\n    this.updateHighlightedInstructions();\n    this.updateHotness();\n  }\n\n  private renderMIRInstruction(ins: MIRInstruction): HTMLElement {\n    const prettyOpcode = ins.opcode\n      .replace('->', '\u2192')\n      .replace('<-', '\u2190');\n\n    const row = document.createElement(\"tr\");\n    row.classList.add(\n      \"ig-ins\", \"ig-ins-mir\", \"ig-can-flash\",\n      ...ins.attributes.map(att => `ig-ins-att-${att}`),\n    );\n    row.setAttribute(\"data-ig-ins-ptr\", `${ins.ptr}`);\n    row.setAttribute(\"data-ig-ins-id\", `${ins.id}`);\n\n    const num = document.createElement(\"td\");\n    num.classList.add(\"ig-ins-num\");\n    num.innerText = String(ins.id);\n    row.appendChild(num);\n\n    const opcode = document.createElement(\"td\");\n    // Build opcode content safely using DOM APIs instead of innerHTML\n    // Pattern: name#id should become clickable spans\n    const usePattern = /([A-Za-z0-9_<>]+)#(\\d+)/g;\n    let lastIndex = 0;\n    let match;\n\n    while ((match = usePattern.exec(prettyOpcode)) !== null) {\n      // Add text before the match\n      if (match.index > lastIndex) {\n        const textBefore = prettyOpcode.substring(lastIndex, match.index);\n        opcode.appendChild(document.createTextNode(textBefore));\n      }\n\n      // Create span for the use reference\n      const useSpan = document.createElement(\"span\");\n      useSpan.className = \"ig-use ig-highlightable\";\n      useSpan.setAttribute(\"data-ig-use\", encodeURIComponent(match[2]));\n      useSpan.textContent = `${match[1]}#${match[2]}`;\n      opcode.appendChild(useSpan);\n\n      lastIndex = usePattern.lastIndex;\n    }\n\n    // Add remaining text after last match\n    if (lastIndex < prettyOpcode.length) {\n      const textAfter = prettyOpcode.substring(lastIndex);\n      opcode.appendChild(document.createTextNode(textAfter));\n    }\n\n    row.appendChild(opcode);\n\n    const type = document.createElement(\"td\");\n    type.classList.add(\"ig-ins-type\");\n    type.innerText = ins.type === \"None\" ? \"\" : ins.type;\n    row.appendChild(type);\n\n    // Event listeners\n    num.addEventListener(\"pointerdown\", e => {\n      e.preventDefault();\n      e.stopPropagation();\n    });\n    num.addEventListener(\"click\", () => {\n      this.toggleInstructionHighlight(ins.ptr);\n    });\n\n    opcode.querySelectorAll<HTMLElement>(\".ig-use\").forEach(use => {\n      use.addEventListener(\"pointerdown\", e => {\n        e.preventDefault();\n        e.stopPropagation();\n      });\n      use.addEventListener(\"click\", e => {\n        const id = parseInt(must(use.getAttribute(\"data-ig-use\")), 10) as InsID;\n        this.jumpToInstruction(id, { zoom: 1 });\n      });\n    });\n\n    return row;\n  }\n\n  private renderLIRInstruction(ins: LIRInstruction): HTMLElement {\n    const prettyOpcode = ins.opcode\n      .replace('->', '\u2192')\n      .replace('<-', '\u2190');\n\n    const row = document.createElement(\"tr\");\n    row.classList.add(\"ig-ins\", \"ig-ins-lir\", \"ig-hotness\");\n    row.setAttribute(\"data-ig-ins-ptr\", `${ins.ptr}`);\n    row.setAttribute(\"data-ig-ins-id\", `${ins.id}`);\n\n    const num = document.createElement(\"td\");\n    num.classList.add(\"ig-ins-num\");\n    num.innerText = String(ins.id);\n    row.appendChild(num);\n\n    const opcode = document.createElement(\"td\");\n    opcode.innerText = prettyOpcode;\n    row.appendChild(opcode);\n\n    if (this.sampleCounts) {\n      const totalSampleCount = this.sampleCounts?.totalLineHits.get(ins.id) ?? 0;\n      const selfSampleCount = this.sampleCounts?.selfLineHits.get(ins.id) ?? 0;\n\n      const totalSamples = document.createElement(\"td\");\n      totalSamples.classList.add(\"ig-ins-samples\");\n      totalSamples.classList.toggle(\"ig-text-dim\", totalSampleCount === 0);\n      totalSamples.innerText = `${totalSampleCount}`;\n      totalSamples.title = \"Color by total count\";\n      row.appendChild(totalSamples);\n\n      const selfSamples = document.createElement(\"td\");\n      selfSamples.classList.add(\"ig-ins-samples\");\n      selfSamples.classList.toggle(\"ig-text-dim\", selfSampleCount === 0);\n      selfSamples.innerText = `${selfSampleCount}`;\n      selfSamples.title = \"Color by self count\";\n      row.appendChild(selfSamples);\n\n      // Event listeners\n      for (const [i, el] of [totalSamples, selfSamples].entries()) {\n        el.addEventListener(\"pointerdown\", e => {\n          e.preventDefault();\n          e.stopPropagation();\n        });\n        el.addEventListener(\"click\", () => {\n          assert(i === SC_TOTAL || i === SC_SELF);\n          this.heatmapMode = i;\n          this.updateHotness();\n        });\n      }\n    }\n\n    // Event listeners\n    num.addEventListener(\"pointerdown\", e => {\n      e.preventDefault();\n      e.stopPropagation();\n    });\n    num.addEventListener(\"click\", () => {\n      this.toggleInstructionHighlight(ins.ptr);\n    });\n\n    return row;\n  }\n\n  private renderSelection() {\n    this.graphContainer.querySelectorAll(\".ig-block\").forEach(blockEl => {\n      const ptr = parseInt(must(blockEl.getAttribute(\"data-ig-block-ptr\")), 10) as BlockPtr;\n      blockEl.classList.toggle(\"ig-selected\", this.selectedBlockPtrs.has(ptr));\n      blockEl.classList.toggle(\"ig-last-selected\", this.lastSelectedBlockPtr === ptr);\n    });\n  }\n\n  private removeNonexistentHighlights() {\n    this.highlightedInstructions = this.highlightedInstructions.filter(hi => {\n      return this.graphContainer.querySelector<HTMLElement>(`.ig-ins[data-ig-ins-ptr=\"${hi.ptr}\"]`);\n    });\n  }\n\n  private updateHighlightedInstructions() {\n    for (const hi of this.highlightedInstructions) {\n      assert(this.highlightedInstructions.filter(other => other.ptr === hi.ptr).length === 1, `instruction ${hi.ptr} was highlighted more than once`);\n    }\n\n    // Clear all existing highlight styles\n    this.graphContainer.querySelectorAll<HTMLElement>(\".ig-ins, .ig-use\").forEach(ins => {\n      clearHighlight(ins);\n    });\n\n    // Highlight all instructions\n    for (const hi of this.highlightedInstructions) {\n      const color = this.instructionPalette[hi.paletteColor % this.instructionPalette.length];\n      const row = this.graphContainer.querySelector<HTMLElement>(`.ig-ins[data-ig-ins-ptr=\"${hi.ptr}\"]`);\n      if (row) {\n        highlight(row, color);\n\n        const id = this.insIDsByPtr.get(hi.ptr);\n        this.graphContainer.querySelectorAll<HTMLElement>(`.ig-use[data-ig-use=\"${id}\"]`).forEach(use => {\n          highlight(use, color);\n        });\n      }\n    }\n  }\n\n  private updateHotness() {\n    this.graphContainer.querySelectorAll<HTMLElement>(\".ig-ins-lir\").forEach(insEl => {\n      assert(insEl.classList.contains(\"ig-hotness\"));\n      const insID = parseInt(must(insEl.getAttribute(\"data-ig-ins-id\")), 10);\n      let hotness = 0;\n      if (this.sampleCounts) {\n        const counts = this.heatmapMode === SC_TOTAL ? this.sampleCounts.totalLineHits : this.sampleCounts.selfLineHits;\n        hotness = (counts.get(insID) ?? 0) / this.maxSampleCounts[this.heatmapMode];\n      }\n      insEl.style.setProperty(\"--ig-hotness\", `${hotness}`);\n    });\n  }\n\n  private addEventListeners() {\n    this.viewport.addEventListener(\"wheel\", e => {\n      e.preventDefault();\n\n      let newZoom = this.zoom;\n      if (e.ctrlKey) {\n        newZoom = Math.max(MIN_ZOOM, Math.min(MAX_ZOOM, this.zoom * Math.pow(ZOOM_SENSITIVITY, -e.deltaY * WHEEL_DELTA_SCALE)));\n        const zoomDelta = (newZoom / this.zoom) - 1;\n        this.zoom = newZoom;\n\n        const { x: gx, y: gy } = this.viewport.getBoundingClientRect();\n        const mouseOffsetX = (e.clientX - gx) - this.translation.x;\n        const mouseOffsetY = (e.clientY - gy) - this.translation.y;\n        this.translation.x -= mouseOffsetX * zoomDelta;\n        this.translation.y -= mouseOffsetY * zoomDelta;\n      } else {\n        this.translation.x -= e.deltaX;\n        this.translation.y -= e.deltaY;\n      }\n\n      const clampedT = this.clampTranslation(this.translation, newZoom);\n      this.translation.x = clampedT.x;\n      this.translation.y = clampedT.y;\n\n      this.animating = false;\n      this.updatePanAndZoom();\n    });\n    this.viewport.addEventListener(\"pointerdown\", e => {\n      if (e.pointerType === \"mouse\" && !(e.button === 0 || e.button === 1)) {\n        return;\n      }\n\n      e.preventDefault();\n      this.viewport.setPointerCapture(e.pointerId);\n      this.startMousePos = {\n        x: e.clientX,\n        y: e.clientY,\n      };\n      this.lastMousePos = {\n        x: e.clientX,\n        y: e.clientY,\n      };\n      this.animating = false;\n    });\n    this.viewport.addEventListener(\"pointermove\", e => {\n      if (!this.viewport.hasPointerCapture(e.pointerId)) {\n        return;\n      }\n\n      const dx = (e.clientX - this.lastMousePos.x);\n      const dy = (e.clientY - this.lastMousePos.y);\n      this.translation.x += dx;\n      this.translation.y += dy;\n      this.lastMousePos = {\n        x: e.clientX,\n        y: e.clientY,\n      };\n\n      const clampedT = this.clampTranslation(this.translation, this.zoom);\n      this.translation.x = clampedT.x;\n      this.translation.y = clampedT.y;\n\n      this.animating = false;\n      this.updatePanAndZoom();\n    });\n    this.viewport.addEventListener(\"pointerup\", e => {\n      this.viewport.releasePointerCapture(e.pointerId);\n\n      const THRESHOLD = 2;\n      const deltaX = this.startMousePos.x - e.clientX;\n      const deltaY = this.startMousePos.y - e.clientY;\n      if (Math.abs(deltaX) <= THRESHOLD && Math.abs(deltaY) <= THRESHOLD) {\n        this.setSelection([]);\n      }\n\n      this.animating = false;\n    });\n\n    // Observe resizing of the viewport (so we don't have to trigger style\n    // calculation in hot paths)\n    const ro = new ResizeObserver(entries => {\n      assert(entries.length === 1);\n      const rect = entries[0].contentRect;\n      this.viewportSize.x = rect.width;\n      this.viewportSize.y = rect.height;\n    });\n    ro.observe(this.viewport);\n  }\n\n  setSelection(blockPtrs: BlockPtr[], lastSelectedPtr: BlockPtr = 0 as BlockPtr) {\n    this.setSelectionRaw(blockPtrs, lastSelectedPtr);\n    if (!lastSelectedPtr) {\n      this.nav = {\n        visited: [],\n        currentIndex: -1,\n        siblings: [],\n      };\n    } else {\n      this.nav = {\n        visited: [lastSelectedPtr],\n        currentIndex: 0,\n        siblings: [lastSelectedPtr],\n      };\n    }\n  }\n\n  private setSelectionRaw(blockPtrs: BlockPtr[], lastSelectedPtr: BlockPtr) {\n    this.selectedBlockPtrs.clear();\n    for (const blockPtr of [...blockPtrs, lastSelectedPtr]) {\n      if (this.blocksByPtr.has(blockPtr)) {\n        this.selectedBlockPtrs.add(blockPtr);\n      }\n    }\n    this.lastSelectedBlockPtr = this.blocksByPtr.has(lastSelectedPtr) ? lastSelectedPtr : 0 as BlockPtr;\n    this.renderSelection();\n  }\n\n  navigate(dir: \"down\" | \"up\" | \"left\" | \"right\") {\n    const selected = this.lastSelectedBlockPtr;\n\n    if (dir === \"down\" || dir === \"up\") {\n      // Vertical navigation\n      if (!selected) {\n        const blocks = [...this.blocks].sort((a, b) => a.id - b.id);\n        // No block selected; start navigation anew\n        const rootBlocks = blocks.filter(b => b.preds.length === 0);\n        const leafBlocks = blocks.filter(b => b.succs.length === 0);\n        const fauxSiblings = dir === \"down\" ? rootBlocks : leafBlocks;\n        const firstBlock = fauxSiblings[0];\n        assert(firstBlock);\n        this.setSelectionRaw([], firstBlock.ptr);\n        this.nav = {\n          visited: [firstBlock.ptr],\n          currentIndex: 0,\n          siblings: fauxSiblings.map(b => b.ptr),\n        };\n      } else {\n        // Move to the current block's successors or predecessors,\n        // respecting the visited stack\n        const currentBlock = must(this.blocksByPtr.get(selected));\n        const nextSiblings: BlockPtr[] = (\n          dir === \"down\"\n            ? currentBlock.succs\n            : currentBlock.preds\n        ).map(next => next.ptr);\n\n        // If we have navigated to a different sibling at our current point in\n        // the stack, we have gone off our prior track and start a new one.\n        if (currentBlock.ptr !== this.nav.visited[this.nav.currentIndex]) {\n          this.nav.visited = [currentBlock.ptr];\n          this.nav.currentIndex = 0;\n        }\n\n        const nextIndex = this.nav.currentIndex + (dir === \"down\" ? 1 : -1);\n        if (0 <= nextIndex && nextIndex < this.nav.visited.length) {\n          // Move to existing block in visited stack\n          this.nav.currentIndex = nextIndex;\n          this.nav.siblings = nextSiblings;\n        } else {\n          // Push a new block onto the visited stack (either at the front or back)\n          const next: BlockPtr | undefined = nextSiblings[0];\n          if (next !== undefined) {\n            if (dir === \"down\") {\n              this.nav.visited.push(next);\n              this.nav.currentIndex += 1;\n              assert(this.nav.currentIndex === this.nav.visited.length - 1);\n            } else {\n              this.nav.visited.unshift(next);\n              assert(this.nav.currentIndex === 0);\n            }\n            this.nav.siblings = nextSiblings;\n          }\n        }\n\n        this.setSelectionRaw([], this.nav.visited[this.nav.currentIndex]);\n      }\n    } else {\n      // Horizontal navigation\n      if (selected !== undefined) {\n        const i = this.nav.siblings.indexOf(selected);\n        assert(i >= 0, \"currently selected node should be in siblings array\");\n        const nextI = i + (dir === \"right\" ? 1 : -1);\n        if (0 <= nextI && nextI < this.nav.siblings.length) {\n          this.setSelectionRaw([], this.nav.siblings[nextI]);\n        }\n      }\n    }\n\n    assert(this.nav.visited.length === 0 || this.nav.siblings.includes(this.nav.visited[this.nav.currentIndex]), \"expected currently visited node to be in the siblings array\");\n    assert(this.lastSelectedBlockPtr === 0 || this.nav.siblings.includes(this.lastSelectedBlockPtr), \"expected currently selected block to be in siblings array\");\n  }\n\n  toggleInstructionHighlight(insPtr: InsPtr, force?: boolean) {\n    this.removeNonexistentHighlights();\n\n    const indexOfExisting = this.highlightedInstructions.findIndex(hi => hi.ptr === insPtr);\n    let remove = indexOfExisting >= 0;\n    if (force !== undefined) {\n      remove = !force;\n    }\n\n    if (remove) {\n      if (indexOfExisting >= 0) {\n        this.highlightedInstructions.splice(indexOfExisting, 1);\n      }\n    } else {\n      if (indexOfExisting < 0) {\n        let nextPaletteColor = 0;\n        while (true) {\n          if (this.highlightedInstructions.find(hi => hi.paletteColor === nextPaletteColor)) {\n            nextPaletteColor += 1;\n            continue;\n          }\n          break;\n        }\n\n        this.highlightedInstructions.push({\n          ptr: insPtr,\n          paletteColor: nextPaletteColor,\n        });\n      }\n    }\n\n    this.updateHighlightedInstructions();\n  }\n\n  private clampTranslation(t: Vec2, scale: number): Vec2 {\n    const minX = TRANSLATION_CLAMP_AMOUNT - this.size.x * scale;\n    const maxX = this.viewportSize.x - TRANSLATION_CLAMP_AMOUNT;\n    const minY = TRANSLATION_CLAMP_AMOUNT - this.size.y * scale;\n    const maxY = this.viewportSize.y - TRANSLATION_CLAMP_AMOUNT;\n\n    const newX = clamp(t.x, minX, maxX);\n    const newY = clamp(t.y, minY, maxY);\n\n    return { x: newX, y: newY };\n  }\n\n  updatePanAndZoom() {\n    // We clamp here as well as in the input events because we want to respect\n    // the clamped limits even when jumping from pass to pass. But then when we\n    // actually receive input we want the clamping to \"stick\".\n    const clampedT = this.clampTranslation(this.translation, this.zoom);\n    this.graphContainer.style.transform = `translate(${clampedT.x}px, ${clampedT.y}px) scale(${this.zoom})`;\n  }\n\n  /**\n   * Converts from graph space to viewport space.\n   */\n  graph2viewport(v: Vec2, translation: Vec2 = this.translation, zoom: number = this.zoom): Vec2 {\n    return {\n      x: v.x * zoom + translation.x,\n      y: v.y * zoom + translation.y,\n    };\n  }\n\n  /**\n   * Converts from viewport space to graph space.\n   */\n  viewport2graph(v: Vec2, translation: Vec2 = this.translation, zoom: number = this.zoom): Vec2 {\n    return {\n      x: (v.x - translation.x) / zoom,\n      y: (v.y - translation.y) / zoom,\n    };\n  }\n\n  /**\n   * Pans and zooms the graph such that the given x and y in graph space are in\n   * the top left of the viewport.\n   */\n  async goToGraphCoordinates(\n    coords: Vec2,\n    { zoom = this.zoom, animate = true }: {\n      zoom?: number,\n      animate?: boolean\n    },\n  ) {\n    const newTranslation = { x: -coords.x * zoom, y: -coords.y * zoom };\n\n    if (!animate) {\n      this.animating = false;\n      this.translation.x = newTranslation.x;\n      this.translation.y = newTranslation.y;\n      this.zoom = zoom;\n      this.updatePanAndZoom();\n      await new Promise(res => setTimeout(res, 0));\n      return;\n    }\n\n    this.targetTranslation = newTranslation;\n    this.targetZoom = zoom;\n    if (this.animating) {\n      // Do not start another animation loop.\n      //\n      // TODO: Be fancy and return a promise that will resolve when the\n      // existing animation loop resolves.\n      return;\n    }\n\n    this.animating = true;\n    let lastTime = performance.now();\n    while (this.animating) {\n      const now = await new Promise<number>(res => requestAnimationFrame(res));\n      const dt = (now - lastTime) / 1000;\n      lastTime = now;\n\n      const THRESHOLD_T = 1, THRESHOLD_ZOOM = 0.01;\n      const R = 0.000001; // fraction remaining after one second: smaller = faster\n      const dx = this.targetTranslation.x - this.translation.x;\n      const dy = this.targetTranslation.y - this.translation.y;\n      const dzoom = this.targetZoom - this.zoom;\n      this.translation.x = filerp(this.translation.x, this.targetTranslation.x, R, dt);\n      this.translation.y = filerp(this.translation.y, this.targetTranslation.y, R, dt);\n      this.zoom = filerp(this.zoom, this.targetZoom, R, dt);\n      this.updatePanAndZoom();\n\n      if (\n        Math.abs(dx) <= THRESHOLD_T\n        && Math.abs(dy) <= THRESHOLD_T\n        && Math.abs(dzoom) <= THRESHOLD_ZOOM\n      ) {\n        this.translation.x = this.targetTranslation.x;\n        this.translation.y = this.targetTranslation.y;\n        this.zoom = this.targetZoom;\n        this.animating = false;\n        this.updatePanAndZoom();\n        break;\n      }\n    }\n\n    // Delay by one update so that CSS changes before/after animation will\n    // always take effect, e.g. for .ig-flash.\n    await new Promise(res => setTimeout(res, 0));\n  }\n\n  jumpToBlock(\n    blockPtr: BlockPtr,\n    { zoom = this.zoom, animate = true, viewportPos }: {\n      zoom?: number,\n      animate?: boolean,\n      viewportPos?: Vec2,\n    } = {},\n  ) {\n    const block = this.blocksByPtr.get(blockPtr);\n    if (!block) {\n      return Promise.resolve();\n    }\n\n    // If layout hasn't been computed yet, defer the jump until after layout\n    if (!block.layoutNode) {\n      this.deferredJumpToBlock = { blockPtr, opts: { zoom, animate, viewportPos } };\n      return Promise.resolve();\n    }\n\n    let graphCoords: Vec2;\n    if (viewportPos) {\n      graphCoords = {\n        x: block.layoutNode.pos.x - viewportPos.x / zoom,\n        y: block.layoutNode.pos.y - viewportPos.y / zoom,\n      };\n    } else {\n      graphCoords = this.graphPosToCenterRect(block.layoutNode.pos, block.layoutNode.size, zoom);\n    }\n    return this.goToGraphCoordinates(graphCoords, { zoom, animate });\n  }\n\n  async jumpToInstruction(\n    insID: InsID,\n    { zoom = this.zoom, animate = true }: {\n      zoom?: number,\n      animate?: boolean,\n    },\n  ) {\n    // Since we don't have graph-layout coordinates for instructions, we have\n    // to reverse engineer them from their client position.\n    const insEl = this.graphContainer.querySelector<HTMLElement>(`.ig-ins[data-ig-ins-id=\"${insID}\"]`);\n    if (!insEl) {\n      return;\n    }\n\n    const insRect = insEl.getBoundingClientRect();\n    const graphRect = this.graphContainer.getBoundingClientRect();\n\n    const x = (insRect.x - graphRect.x) / this.zoom;\n    const y = (insRect.y - graphRect.y) / this.zoom;\n    const width = insRect.width / this.zoom;\n    const height = insRect.height / this.zoom;\n\n    const coords = this.graphPosToCenterRect({ x, y }, { x: width, y: height }, zoom);\n    insEl.classList.add(\"ig-flash\");\n    await this.goToGraphCoordinates(coords, { zoom, animate });\n    insEl.classList.remove(\"ig-flash\");\n  }\n\n  /**\n   * Returns the position in graph space that, if panned to, will center the\n   * given graph-space rectangle in the viewport.\n   */\n  graphPosToCenterRect(pos: Vec2, size: Vec2, zoom: number): Vec2 {\n    const viewportWidth = this.viewportSize.x / zoom;\n    const viewportHeight = this.viewportSize.y / zoom;\n    const xPadding = Math.max(20 / zoom, (viewportWidth - size.x) / 2);\n    const yPadding = Math.max(20 / zoom, (viewportHeight - size.y) / 2);\n    const x = pos.x - xPadding;\n    const y = pos.y - yPadding;\n    return { x, y };\n  }\n\n  exportState(): GraphState {\n    const state: GraphState = {\n      translation: this.translation,\n      zoom: this.zoom,\n      heatmapMode: this.heatmapMode,\n      highlightedInstructions: this.highlightedInstructions,\n      selectedBlockPtrs: this.selectedBlockPtrs,\n      lastSelectedBlockPtr: this.lastSelectedBlockPtr,\n\n      viewportPosOfSelectedBlock: undefined,\n    };\n\n    if (this.lastSelectedBlockPtr) {\n      state.viewportPosOfSelectedBlock = this.graph2viewport(must(this.blocksByPtr.get(this.lastSelectedBlockPtr)).layoutNode.pos);\n    }\n\n    return state;\n  }\n\n  restoreState(state: GraphState, opts: RestoreStateOpts) {\n    this.translation.x = state.translation.x;\n    this.translation.y = state.translation.y;\n    this.zoom = state.zoom;\n    this.heatmapMode = state.heatmapMode;\n    this.highlightedInstructions = state.highlightedInstructions;\n    this.setSelection(Array.from(state.selectedBlockPtrs), state.lastSelectedBlockPtr);\n\n    this.updatePanAndZoom();\n    this.updateHotness();\n    this.updateHighlightedInstructions();\n\n    // If there was no last selected block, or if the last selected block no\n    // longer exists, jumpToBlock will do nothing. This is fine.\n    if (opts.preserveSelectedBlockPosition) {\n      this.jumpToBlock(this.lastSelectedBlockPtr, {\n        zoom: this.zoom,\n        animate: false,\n        viewportPos: state.viewportPosOfSelectedBlock,\n      });\n    }\n  }\n}\n\nfunction* dummies(layoutNodesByLayer: LayoutNode[][]) {\n  for (const nodes of layoutNodesByLayer) {\n    for (const node of nodes) {\n      if (node.block === null) {\n        yield node;\n      }\n    }\n  }\n}\n\nfunction downwardArrow(\n  x1: number, y1: number,\n  x2: number, y2: number,\n  ym: number,\n  doArrowhead: boolean,\n  stroke = 1,\n): SVGElement {\n  const r = ARROW_RADIUS;\n\n  // Align stroke to pixels\n  if (stroke % 2 === 1) {\n    x1 += 0.5;\n    x2 += 0.5;\n    ym += 0.5;\n  }\n\n  let path = \"\";\n  path += `M ${x1} ${y1} `; // move to start\n\n  if (Math.abs(x2 - x1) < 2 * r) {\n    // Degenerate case where the radii won't fit; fall back to bezier.\n    path += `C ${x1} ${y1 + (y2 - y1) / 3} ${x2} ${y1 + 2 * (y2 - y1) / 3} ${x2} ${y2} `;\n  } else {\n    const dir = Math.sign(x2 - x1);\n    path += `L ${x1} ${ym - r} `; // line down\n    path += `A ${r} ${r} 0 0 ${dir > 0 ? 0 : 1} ${x1 + r * dir} ${ym} `; // arc to joint\n    path += `L ${x2 - r * dir} ${ym} `; // joint\n    path += `A ${r} ${r} 0 0 ${dir > 0 ? 1 : 0} ${x2} ${ym + r} `; // arc to line\n    path += `L ${x2} ${y2} `; // line down\n  }\n\n  const g = document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\");\n  const p = document.createElementNS(\"http://www.w3.org/2000/svg\", \"path\");\n  p.setAttribute(\"d\", path);\n  p.setAttribute(\"fill\", \"none\");\n  p.setAttribute(\"stroke\", \"black\");\n  p.setAttribute(\"stroke-width\", `${stroke} `);\n  g.appendChild(p);\n\n  if (doArrowhead) {\n    const v = arrowhead(x2, y2, 180);\n    g.appendChild(v);\n  }\n\n  return g;\n}\n\nfunction upwardArrow(\n  x1: number, y1: number,\n  x2: number, y2: number,\n  ym: number,\n  doArrowhead: boolean,\n  stroke = 1,\n): SVGElement {\n  const r = ARROW_RADIUS;\n\n  // Align stroke to pixels\n  if (stroke % 2 === 1) {\n    x1 += 0.5;\n    x2 += 0.5;\n    ym += 0.5;\n  }\n\n  let path = \"\";\n  path += `M ${x1} ${y1} `; // move to start\n\n  if (Math.abs(x2 - x1) < 2 * r) {\n    // Degenerate case where the radii won't fit; fall back to bezier.\n    path += `C ${x1} ${y1 + (y2 - y1) / 3} ${x2} ${y1 + 2 * (y2 - y1) / 3} ${x2} ${y2} `;\n  } else {\n    const dir = Math.sign(x2 - x1);\n    path += `L ${x1} ${ym + r} `; // line up\n    path += `A ${r} ${r} 0 0 ${dir > 0 ? 1 : 0} ${x1 + r * dir} ${ym} `; // arc to joint\n    path += `L ${x2 - r * dir} ${ym} `; // joint\n    path += `A ${r} ${r} 0 0 ${dir > 0 ? 0 : 1} ${x2} ${ym - r} `; // arc to line\n    path += `L ${x2} ${y2} `; // line up\n  }\n\n  const g = document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\");\n  const p = document.createElementNS(\"http://www.w3.org/2000/svg\", \"path\");\n  p.setAttribute(\"d\", path);\n  p.setAttribute(\"fill\", \"none\");\n  p.setAttribute(\"stroke\", \"black\");\n  p.setAttribute(\"stroke-width\", `${stroke} `);\n  g.appendChild(p);\n\n  if (doArrowhead) {\n    const v = arrowhead(x2, y2, 0);\n    g.appendChild(v);\n  }\n\n  return g;\n}\n\nfunction arrowFromBlockToBackedgeDummy(\n  x1: number, y1: number,\n  x2: number, y2: number,\n  ym: number,\n  stroke = 1,\n): SVGElement {\n  const r = ARROW_RADIUS;\n\n  if (stroke % 2 === 1) {\n    x1 += 0.5;\n    x2 += 0.5;\n    ym += 0.5;\n  }\n\n  let path = \"\";\n  path += `M ${x1} ${y1} `; // move to start\n  path += `L ${x1} ${ym - r} `; // line down\n  path += `A ${r} ${r} 0 0 0 ${x1 + r} ${ym} `; // arc to horizontal joint\n  path += `L ${x2 - r} ${ym} `; // horizontal joint\n  path += `A ${r} ${r} 0 0 0 ${x2} ${ym - r} `; // arc to line\n  path += `L ${x2} ${y2} `; // line up (or down depending on y2)\n\n  const g = document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\");\n\n  const p = document.createElementNS(\"http://www.w3.org/2000/svg\", \"path\");\n  p.setAttribute(\"d\", path);\n  p.setAttribute(\"fill\", \"none\");\n  p.setAttribute(\"stroke\", \"black\");\n  p.setAttribute(\"stroke-width\", `${stroke} `);\n  g.appendChild(p);\n\n  return g;\n}\n\nfunction arrowBackedgeEnd(\n  x1: number, y1: number,\n  x2: number, y2: number,\n  yHigh: number,\n  stroke = 1,\n): SVGElement {\n  // Draws the final segment of a backedge:\n  // Starts at x1,y1 (Dummy). Goes UP to yHigh.\n  // Then LEFT to x2.\n  // Then DOWN to y2 (Block).\n  const r = ARROW_RADIUS;\n\n  // Align stroke to pixels\n  if (stroke % 2 === 1) {\n    x1 += 0.5;\n    x2 += 0.5;\n    y1 += 0.5;\n    y2 += 0.5;\n    yHigh += 0.5;\n  }\n\n  let path = \"\";\n  path += `M ${x1} ${y1} `; // move to start\n  path += `L ${x1} ${yHigh + r} `; // Up\n  path += `A ${r} ${r} 0 0 0 ${x1 - r} ${yHigh} `; // Arc left\n  path += `L ${x2 + r} ${yHigh} `; // Left\n  path += `A ${r} ${r} 0 0 0 ${x2} ${yHigh + r} `; // Arc down\n  path += `L ${x2} ${y2} `; // Down\n\n  const g = document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\");\n  const p = document.createElementNS(\"http://www.w3.org/2000/svg\", \"path\");\n  p.setAttribute(\"d\", path);\n  p.setAttribute(\"fill\", \"none\");\n  p.setAttribute(\"stroke\", \"black\");\n  p.setAttribute(\"stroke-width\", `${stroke} `);\n  g.appendChild(p);\n\n  const v = arrowhead(x2, y2, 180); // Pointing down\n  g.appendChild(v);\n\n  return g;\n}\n\nfunction arrowhead(x: number, y: number, rot: number, size = 5): SVGElement {\n  const p = document.createElementNS(\"http://www.w3.org/2000/svg\", \"path\");\n  p.setAttribute(\"d\", `M 0 0 L ${-size} ${size * 1.5} L ${size} ${size * 1.5} Z`);\n  p.setAttribute(\"transform\", `translate(${x}, ${y}) rotate(${rot})`);\n  return p;\n}\n\nfunction highlight(el: HTMLElement, color: string) {\n  el.classList.add(\"ig-highlight\");\n  el.style.setProperty(\"--ig-highlight-color\", color);\n}\n\nfunction clearHighlight(el: HTMLElement) {\n  el.classList.remove(\"ig-highlight\");\n  el.style.setProperty(\"--ig-highlight-color\", \"transparent\");\n}\n", "import { dequal } from \"./dequal.js\";\nimport { E } from \"./dom.js\";\nimport { Graph } from \"./Graph.js\";\nimport type { BlockPtr, Func, Pass, SampleCounts } from \"./iongraph.js\";\n\ntype KeyPasses = [number | null, number | null, number | null, number | null];\n\nexport interface GraphViewerProps {\n  func: Func,\n  pass?: number,\n\n  sampleCounts?: SampleCounts,\n}\n\nexport class GraphViewer {\n  func: Func;\n  passNumber: number;\n  keyPasses: KeyPasses;\n  redundantPasses: number[];\n  sampleCounts: SampleCounts | undefined;\n\n  container: HTMLDivElement;\n  viewport: HTMLDivElement;\n  graph: Graph | null;\n  sidebarLinks: HTMLAnchorElement[];\n\n  constructor(root: HTMLElement, {\n    func,\n    pass = 0,\n\n    sampleCounts\n  }: GraphViewerProps) {\n    this.graph = null;\n    this.func = func;\n    this.passNumber = pass;\n    this.sampleCounts = sampleCounts;\n\n    this.keyPasses = [null, null, null, null];\n    {\n      let lastPass: Pass | null = null;\n      for (const [i, pass] of func.passes.entries()) {\n        if (pass.mir.blocks.length > 0) {\n          if (this.keyPasses[0] === null) {\n            this.keyPasses[0] = i;\n          }\n          if (pass.lir.blocks.length === 0) {\n            this.keyPasses[1] = i;\n          }\n        }\n        if (pass.lir.blocks.length > 0) {\n          if (lastPass?.lir.blocks.length === 0) {\n            this.keyPasses[2] = i;\n          }\n          this.keyPasses[3] = i;\n        }\n\n        lastPass = pass;\n      }\n    }\n\n    this.redundantPasses = [];\n    {\n      let lastPass: Pass | null = null;\n      for (const [i, pass] of func.passes.entries()) {\n        if (lastPass === null) {\n          lastPass = pass;\n          continue;\n        }\n\n        if (dequal(lastPass.mir, pass.mir) && dequal(lastPass.lir, pass.lir)) {\n          this.redundantPasses.push(i);\n        }\n\n        lastPass = pass;\n      }\n    }\n\n    this.viewport = E(\"div\", [\"ig-flex-grow-1\", \"ig-overflow-hidden\"], div => {\n      div.style.position = \"relative\";\n    })\n    this.sidebarLinks = func.passes.map((pass, i) => (\n      E(\"a\", [\"ig-link-normal\", \"ig-pv1\", \"ig-ph2\", \"ig-flex\", \"ig-g2\"], a => {\n        a.href = \"#\";\n        a.addEventListener(\"click\", e => {\n          e.preventDefault();\n          this.switchPass(i);\n        });\n        a.style.minWidth = \"100%\";\n      }, [\n        E(\"div\", [\"ig-w1\", \"ig-tr\", \"ig-f6\", \"ig-text-dim\"], div => {\n          div.style.paddingTop = \"0.08rem\";\n          div.style.flexShrink = \"0\";\n        }, [`${i}`]),\n        E(\"div\", [this.redundantPasses.includes(i) && \"ig-text-dim\"], div => {\n          div.style.whiteSpace = \"nowrap\";\n        }, [pass.name]),\n      ])\n    ));\n    this.container = E(\"div\", [\"ig-absolute\", \"ig-absolute-fill\", \"ig-flex\"], () => { }, [\n      E(\"div\", [\"ig-w5\", \"ig-br\", \"ig-flex-shrink-0\", \"ig-overflow-y-auto\", \"ig-bg-white\"], div => {\n        div.style.overflowX = \"auto\";\n      }, [\n        ...this.sidebarLinks,\n      ]),\n      this.viewport,\n    ]);\n    root.appendChild(this.container);\n\n    this.keydownHandler = this.keydownHandler.bind(this);\n    this.tweakHandler = this.tweakHandler.bind(this);\n    window.addEventListener(\"keydown\", this.keydownHandler);\n    window.addEventListener(\"tweak\", this.tweakHandler);\n\n    this.update();\n  }\n\n  destroy() {\n    this.container.remove();\n    window.removeEventListener(\"keydown\", this.keydownHandler);\n    window.removeEventListener(\"tweak\", this.tweakHandler);\n  }\n\n  update() {\n    // Update sidebar\n    for (const [i, link] of this.sidebarLinks.entries()) {\n      link.classList.toggle(\"ig-bg-primary\", this.passNumber === i);\n    }\n\n    // Update graph\n    const previousState = this.graph?.exportState();\n    this.viewport.innerHTML = \"\";\n    this.graph = null;\n    const pass: Pass | undefined = this.func.passes[this.passNumber];\n    if (pass) {\n      try {\n        this.graph = new Graph(this.viewport, pass, { sampleCounts: this.sampleCounts });\n        if (previousState) {\n          this.graph.restoreState(previousState, { preserveSelectedBlockPosition: true });\n        }\n      } catch (e) {\n        this.viewport.innerHTML = \"An error occurred while laying out the graph. See console.\";\n        console.error(e);\n      }\n    }\n  }\n\n  switchPass(pass: number) {\n    this.passNumber = pass;\n    this.update();\n  }\n\n  keydownHandler(e: KeyboardEvent) {\n    switch (e.key) {\n      case \"w\":\n      case \"s\": {\n        this.graph?.navigate(e.key === \"s\" ? \"down\" : \"up\");\n        this.graph?.jumpToBlock(this.graph.lastSelectedBlockPtr);\n      } break;\n      case \"a\":\n      case \"d\": {\n        this.graph?.navigate(e.key === \"d\" ? \"right\" : \"left\");\n        this.graph?.jumpToBlock(this.graph.lastSelectedBlockPtr);\n      } break;\n\n      case \"f\": {\n        for (let i = this.passNumber + 1; i < this.func.passes.length; i++) {\n          if (!this.redundantPasses.includes(i)) {\n            this.switchPass(i);\n            break;\n          }\n        }\n      } break;\n      case \"r\": {\n        for (let i = this.passNumber - 1; i >= 0; i--) {\n          if (!this.redundantPasses.includes(i)) {\n            this.switchPass(i);\n            break;\n          }\n        }\n      } break;\n      case \"1\":\n      case \"2\":\n      case \"3\":\n      case \"4\": {\n        const keyPassIndex = [\"1\", \"2\", \"3\", \"4\"].indexOf(e.key);\n        const keyPass = this.keyPasses[keyPassIndex];\n        if (typeof keyPass === \"number\") {\n          this.switchPass(keyPass);\n        }\n      } break;\n\n      case \"c\": {\n        const selected = this.graph?.blocksByPtr.get(this.graph?.lastSelectedBlockPtr ?? -1 as BlockPtr);\n        if (selected) {\n          this.graph?.jumpToBlock(selected.ptr, { zoom: 1 });\n        }\n      } break;\n    };\n  }\n\n  tweakHandler() {\n    this.update();\n  }\n}\n", "import { migrate, type IonJSON, type Func, type SampleCounts } from \"../src/iongraph.js\";\nimport { must } from \"../src/utils.js\";\nimport { E } from \"../src/dom.js\";\nimport { GraphViewer } from \"../src/GraphViewer.js\";\n\nconst searchParams = new URL(window.location.toString()).searchParams;\n\nconst initialFuncIndex = searchParams.has(\"func\") ? parseInt(searchParams.get(\"func\")!, 10) : undefined;\nconst initialPass = searchParams.has(\"pass\") ? parseInt(searchParams.get(\"pass\")!, 10) : undefined;\n\ninterface MenuBarProps {\n  browse?: boolean,\n  export?: boolean,\n  funcSelected: (func: Func | null) => void,\n}\n\nclass MenuBar {\n  root: HTMLElement;\n  funcSelector: HTMLElement;\n  funcSelectorNone: HTMLElement;\n  funcName: HTMLElement;\n  exportButton: HTMLButtonElement | null;\n\n  ionjson: IonJSON | null;\n  funcIndex: number;\n  funcSelected: (func: Func | null) => void;\n\n  constructor(props: MenuBarProps) {\n    this.exportButton = null;\n\n    this.ionjson = null;\n    this.funcIndex = initialFuncIndex ?? 0;\n    this.funcSelected = props.funcSelected;\n\n    this.funcSelector = E(\"div\", [], () => { }, [\n      \"Function\",\n      E(\"input\", [\"ig-w3\"], input => {\n        input.type = \"number\";\n        input.min = \"1\";\n        input.addEventListener(\"input\", () => {\n          this.switchFunc(parseInt(input.value, 10) - 1);\n        });\n      }, []),\n      \" / \",\n      E(\"span\", [\"num-functions\"]),\n    ]);\n    this.funcSelectorNone = E(\"div\", [], () => { }, [\"No functions to display.\"]);\n    this.funcName = E(\"div\");\n    this.root = E(\"div\", [\"ig-bb\", \"ig-flex\", \"ig-bg-white\"], () => { }, [\n      E(\"div\", [\"ig-pv2\", \"ig-ph3\", \"ig-flex\", \"ig-g2\", \"ig-items-center\", \"ig-br\", \"ig-hide-if-empty\"], () => { }, [\n        props.browse && E(\"div\", [], () => { }, [\n          E(\"input\", [], input => {\n            input.type = \"file\";\n            input.addEventListener(\"change\", e => {\n              const input = e.target as HTMLInputElement;\n              if (!input.files?.length) {\n                return;\n              }\n              this.fileSelected(input.files[0]);\n            });\n          }),\n        ]),\n        this.funcSelector,\n        this.funcSelectorNone,\n      ]),\n      E(\"div\", [\"ig-flex-grow-1\", \"ig-pv2\", \"ig-ph3\", \"ig-flex\", \"ig-g2\", \"ig-items-center\"], () => { }, [\n        this.funcName,\n        E(\"div\", [\"ig-flex-grow-1\"]),\n        props.export && E(\"div\", [], () => { }, [\n          E(\"button\", [], button => {\n            this.exportButton = button;\n            button.addEventListener(\"click\", () => {\n              this.exportStandalone();\n            });\n          }, [\"Export\"]),\n        ]),\n      ]),\n    ]);\n\n    this.update();\n  }\n\n  async fileSelected(file: File) {\n    const newJSON = JSON.parse(await file.text());\n    this.ionjson = migrate(newJSON);\n    this.switchFunc(0);\n    this.update();\n  }\n\n  switchIonJSON(ionjson: IonJSON) {\n    this.ionjson = ionjson;\n    this.switchFunc(this.funcIndex);\n  }\n\n  switchFunc(funcIndex: number) {\n    funcIndex = Math.max(0, Math.min(this.numFunctions() - 1, funcIndex));\n    this.funcIndex = isNaN(funcIndex) ? 0 : funcIndex;\n    this.funcSelected(this.ionjson?.functions[this.funcIndex] ?? null);\n    this.update();\n  }\n\n  numFunctions() {\n    return this.ionjson?.functions.length ?? 0;\n  }\n\n  update() {\n    const funcIndexValid = 0 <= this.funcIndex && this.funcIndex < this.numFunctions();\n\n    this.funcSelector.hidden = this.numFunctions() <= 1;\n    this.funcSelectorNone.hidden = !(this.ionjson && this.numFunctions() === 0);\n\n    const funcInput = this.funcSelector.querySelector(\"input\")!;\n    funcInput.max = `${this.numFunctions()}`;\n    funcInput.value = `${this.funcIndex + 1}`;\n    this.funcSelector.querySelector(\".num-functions\")!.innerHTML = `${this.numFunctions()}`;\n\n    this.funcName.hidden = !funcIndexValid;\n    this.funcName.innerText = `${this.ionjson?.functions[this.funcIndex].name ?? \"\"}`;\n\n    if (this.exportButton) {\n      this.exportButton.disabled = !this.ionjson || !funcIndexValid;\n    }\n  }\n\n  async exportStandalone() {\n    const ion = must(this.ionjson);\n    const name = ion.functions[this.funcIndex].name;\n    const result: IonJSON = { version: 1, functions: [ion.functions[this.funcIndex]] };\n\n    // Use embedded template if available (file:// mode), otherwise fetch\n    const template = (window as any).__standaloneTemplate\n      ?? await (await fetch(\"./standalone.html\")).text();\n    const output = template.replace(/\\{\\{\\s*IONJSON\\s*\\}\\}/, JSON.stringify(result));\n    const url = URL.createObjectURL(new Blob([output], { type: \"text/html;charset=utf-8\" }));\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = `iongraph-${name}.html`;\n    document.body.appendChild(a);\n    a.click();\n    a.remove();\n    URL.revokeObjectURL(url);\n  }\n}\n\nexport class WebUI {\n  root: HTMLElement;\n  menuBar: MenuBar;\n  graphContainer: HTMLElement;\n\n  func: Func | null;\n  sampleCountsFromFile: SampleCounts | undefined;\n  graph: GraphViewer | null;\n\n  constructor() {\n    this.menuBar = new MenuBar({\n      browse: true,\n      export: true,\n      funcSelected: f => this.switchFunc(f),\n    });\n\n    this.func = null;\n    this.sampleCountsFromFile = undefined;\n    this.graph = null;\n\n    this.loadStuffFromQueryParams();\n\n    this.graphContainer = E(\"div\", [\"ig-relative\", \"ig-flex-basis-0\", \"ig-flex-grow-1\", \"ig-overflow-hidden\"]);\n    this.root = E(\"div\", [\"ig-absolute\", \"ig-absolute-fill\", \"ig-flex\", \"ig-flex-column\"], root => {\n      root.addEventListener(\"dragenter\", e => {\n        e.preventDefault();\n        e.stopPropagation();\n      });\n\n      root.addEventListener(\"dragover\", e => {\n        e.preventDefault();\n        e.stopPropagation();\n      });\n\n      root.addEventListener(\"drop\", e => {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const files = e.dataTransfer?.files;\n        if (files && files.length > 0) {\n          this.menuBar.fileSelected(files[0]);\n        }\n      });\n    }, [\n      this.menuBar.root,\n      this.graphContainer,\n    ]);\n\n    this.update();\n  }\n\n  update() {\n    if (this.graph) {\n      this.graph.destroy();\n    }\n    if (this.func) {\n      this.graph = new GraphViewer(this.graphContainer, {\n        func: this.func,\n        pass: initialPass,\n        sampleCounts: this.sampleCountsFromFile,\n      });\n    }\n  }\n\n  loadStuffFromQueryParams() {\n    (async () => {\n      const searchFile = searchParams.get(\"file\");\n      if (searchFile) {\n        const res = await fetch(searchFile);\n        const json = await res.json();\n\n        const migrated = migrate(json);\n        this.menuBar.switchIonJSON(migrated); // will call funcSelected\n      }\n    })();\n    (async () => {\n      const sampleCountsFile = searchParams.get(\"sampleCounts\");\n      if (sampleCountsFile) {\n        const res = await fetch(sampleCountsFile);\n        const json = await res.json();\n        this.sampleCountsFromFile = {\n          selfLineHits: new Map(json[\"selfLineHits\"]),\n          totalLineHits: new Map(json[\"totalLineHits\"]),\n        };\n        this.update();\n      }\n    })();\n  }\n\n  switchFunc(func: Func | null) {\n    this.func = func;\n    this.update();\n  }\n}\n\nexport class StandaloneUI {\n  root: HTMLElement;\n  menuBar: MenuBar;\n  graphContainer: HTMLElement;\n\n  func: Func | null;\n  graph: GraphViewer | null;\n\n  constructor() {\n    this.menuBar = new MenuBar({\n      funcSelected: f => this.switchFunc(f),\n    });\n\n    this.func = null;\n    this.graph = null;\n\n    this.graphContainer = E(\"div\", [\"ig-relative\", \"ig-flex-basis-0\", \"ig-flex-grow-1\", \"ig-overflow-hidden\"]);\n    this.root = E(\"div\", [\"ig-absolute\", \"ig-absolute-fill\", \"ig-flex\", \"ig-flex-column\"], () => { }, [\n      this.menuBar.root,\n      this.graphContainer,\n    ]);\n  }\n\n  update() {\n    if (this.graph) {\n      this.graph.destroy();\n    }\n    if (this.func) {\n      this.graph = new GraphViewer(this.graphContainer, {\n        func: this.func,\n        pass: initialPass,\n      });\n    }\n  }\n\n  setIonJSON(ion: IonJSON) {\n    this.menuBar.switchIonJSON(ion)\n  }\n\n  switchFunc(func: Func | null) {\n    this.func = func;\n    this.update();\n  }\n}\n"],
  "mappings": "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",
  "names": ["tweak", "pass", "input"]
}
